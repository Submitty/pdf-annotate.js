{"version":3,"sources":["webpack://PDFAnnotate/webpack/universalModuleDefinition","webpack://PDFAnnotate/webpack/bootstrap","webpack://PDFAnnotate/./node_modules/events/events.js","webpack://PDFAnnotate/./src/utils/abstractFunction.js","webpack://PDFAnnotate/./src/utils/setAttributes.js","webpack://PDFAnnotate/./src/utils/normalizeColor.js","webpack://PDFAnnotate/./src/render/renderRect.js","webpack://PDFAnnotate/./src/render/renderText.js","webpack://PDFAnnotate/./src/render/renderCircle.js","webpack://PDFAnnotate/./src/utils/mathUtils.js","webpack://PDFAnnotate/./src/render/renderArrow.js","webpack://PDFAnnotate/./src/render/appendChild.js","webpack://PDFAnnotate/./src/render/renderLine.js","webpack://PDFAnnotate/./src/render/renderPoint.js","webpack://PDFAnnotate/./src/render/renderPath.js","webpack://PDFAnnotate/./src/UI/utils.js","webpack://PDFAnnotate/./src/UI/event.js","webpack://PDFAnnotate/./src/adapter/StoreAdapter.js","webpack://PDFAnnotate/./src/utils/uuid.js","webpack://PDFAnnotate/./src/adapter/LocalStoreAdapter.js","webpack://PDFAnnotate/./src/adapter/LocalUserStoreAdapter.js","webpack://PDFAnnotate/./src/config.js","webpack://PDFAnnotate/./src/UI/edit.js","webpack://PDFAnnotate/./src/UI/pen.js","webpack://PDFAnnotate/./src/UI/arrow.js","webpack://PDFAnnotate/./src/UI/eraser.js","webpack://PDFAnnotate/./src/UI/point.js","webpack://PDFAnnotate/./src/UI/rect.js","webpack://PDFAnnotate/./src/UI/circle.js","webpack://PDFAnnotate/./src/UI/text.js","webpack://PDFAnnotate/./src/a11y/createScreenReaderOnly.js","webpack://PDFAnnotate/./src/a11y/insertElementWithinElement.js","webpack://PDFAnnotate/./src/a11y/insertElementWithinChildren.js","webpack://PDFAnnotate/./src/a11y/insertScreenReaderComment.js","webpack://PDFAnnotate/./src/a11y/renderScreenReaderComments.js","webpack://PDFAnnotate/./src/a11y/insertScreenReaderHint.js","webpack://PDFAnnotate/./src/a11y/initEventHandlers.js","webpack://PDFAnnotate/./src/a11y/renderScreenReaderHints.js","webpack://PDFAnnotate/./src/UI/page.js","webpack://PDFAnnotate/./src/UI/index.js","webpack://PDFAnnotate/./src/PDFJSAnnotate.js","webpack://PDFAnnotate/./src/render/index.js","webpack://PDFAnnotate/./index.js"],"names":["root","factory","exports","module","define","amd","window","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","ReflectOwnKeys","R","Reflect","ReflectApply","apply","target","receiver","args","Function","ownKeys","getOwnPropertySymbols","getOwnPropertyNames","concat","NumberIsNaN","Number","isNaN","EventEmitter","init","this","once","emitter","Promise","resolve","reject","errorListener","err","removeListener","resolver","slice","arguments","eventTargetAgnosticAddListener","handler","flags","on","addErrorHandlerIfEventEmitter","_events","undefined","_eventsCount","_maxListeners","defaultMaxListeners","checkListener","listener","TypeError","_getMaxListeners","that","_addListener","type","prepend","events","existing","warning","newListener","emit","unshift","push","length","warned","w","Error","String","count","console","warn","onceWrapper","fired","wrapFn","_onceWrap","state","wrapped","_listeners","unwrap","evlistener","arr","ret","Array","unwrapListeners","arrayClone","listenerCount","copy","addEventListener","wrapListener","arg","removeEventListener","set","RangeError","getPrototypeOf","setMaxListeners","getMaxListeners","doError","error","er","message","context","len","listeners","addListener","prependListener","prependOnceListener","list","position","originalListener","shift","index","pop","spliceOne","off","removeAllListeners","keys","rawListeners","eventNames","abstractFunction","UPPER_REGEX","BLACKLIST","setAttributes","node","attributes","forEach","setAttribute","indexOf","replace","match","toLowerCase","keyCase","REGEX_HASHLESS_HEX","normalizeColor","color","test","createRect","rect","document","createElementNS","x","y","width","height","renderText","a","text","fill","fontSize","size","transform","rotation","style","textElement","textContent","_step","lines","split","getAttribute","_iterator","_createForOfIteratorHelper","done","line","tspan","toString","innerHTML","appendChild","e","f","insertLineBreaks","content","g","renderCircle","circle","cx","cy","createCircle","stroke","translate","rotate","angle","Math","PI","cosValue","cos","sinValue","sin","scale","makePoint","z","makeVector","xcoord","ycoord","zcoord","makeVectorFromPoints","pt1","pt2","addVector","pt","v","multiplyVector","scalar","magnitude","sqrt","pow","negateVector","unitVector","mag","renderArrow","u","arrow","p1","p2","pt0","unitX","unitZ","unitY","thickness","A","B","C","D","G","F","E","points","isFirefox","navigator","userAgent","getTranslation","viewport","trans","nodeName","parseInt","path","querySelector","svg","parentNode","assign","annotation","child","group","JSON","parse","fillOpacity","rectangles","renderRect","strokeWidth","x1","y1","x2","y2","outerSVG","innerSVG","SIZE","viewBox","renderPoint","join","renderPath","uuid","filter","transformChild","userSelectStyleSheet","createElement","findSVGContainer","toUpperCase","findSVGAtPoint","elements","querySelectorAll","el","pointIntersectsRect","getBoundingClientRect","findAnnotationAtPoint","candidate","elementFromPoint","top","bottom","left","right","getOffsetAnnotationRect","extraOffsetWidth","extraOffsetHeight","tagName","getBBox","bbox","_getOffset","offsetLeft","offsetTop","getOffset","scaleUp","result","getMetadata","convertToSvgPoint","xform","offset","convertToScreenPoint","scaleDown","disableUserSelect","head","enableUserSelect","removeChild","documentId","pageNumber","clickNode","fireEvent","clientX","clientY","StoreAdapter","_this","definition","_classCallCheck","__getAnnotations","fn","then","annotations","annotationId","__addAnnotation","__editAnnotation","__deleteAnnotation","success","__addComment","comment","commentId","__deleteComment","REGEXP","replacement","random","LocalStoreAdapter","_StoreAdapter","_inherits","_super","_createSuper","getAnnotations","page","getAnnotation","findAnnotation","addAnnotation","updateAnnotations","editAnnotation","deleteAnnotation","splice","getComments","addComment","class","deleteComment","localStorage","getItem","setItem","stringify","LocalUserStoreAdapter","userId","globalEdit","getAllAnnotations","_userId","_globalEdit","all_annotations","re","RegExp","search","_toConsumableArray","annotationLayerName","textLayerName","annotationSvgQuery","annotationClassQuery","textClassQuery","overlay","dragOffsetX","dragOffsetY","dragStartX","dragStartY","_enabled","isDragging","destroyEditOverlay","handleDocumentClick","handleDocumentKeyup","handleDocumentMousedown","handleDocumentMousemove","handleDocumentMouseup","config","PDFJSAnnotate","getStoreAdapter","getElementById","keyTest","keyCode","preventDefault","background","cursor","display","maxY","maxX","offsetHeight","offsetWidth","attribX","attribY","modelStart","modelEnd","modelDelta","firstChild","modelX","modelY","setTimeout","handleAnnotationClick","anchor","id","styleLeft","styleTop","boxSizing","border","borderRadius","zIndex","padding","textAlign","textDecoration","borderColor","boxShadow","createEditOverlay","_penSize","_penColor","_candraw","handleDocumentPointerdown","handleDocumentPointerup","_getMetadata","saveToStorage","handleDocumentPointermove","point","toFixed","savePoint","originY","originX","_getMetadata2","_canerase","previousPoint","handleDocumentDown","handleDocumentUp","erase","handleDocumentMouseMove","check","diffX","abs","diffY","maxSteps","round","max","subStepSize","min","smallerTest","startPoint","_i","_check","parentElement","input","handleInputBlur","handleInputKeyup","body","focus","closeInput","trim","_type","rects","getSelection","getRangeAt","getClientRects","getSelectionRects","saveRect","map","removeAllRanges","boundingRect","convertToSvgRect","_circleRadius","_circleColor","radius","svg_pt","saveCircle","_textSize","_textColor","srcElement","classList","contains","saveText","shiftKey","createScreenReaderOnly","createTextNode","overflow","insertElementWithinElement","insertBefore","textLayerElementFromPoint","temp","cloneNode","tail","outerHTML","insertElementWithinChildren","nodes","textLayer","insertScreenReaderComment","item","renderScreenReaderComments","comments","isArray","COMMENT_TYPES","reorderAnnotationsByType","removeAnnotation","renderScreenReaderHints","removeElementById","insertComment","removeComment","elementId","SORT_TYPES","sortBy","sort","num","first","last","includes","insertScreenReaderHint","sortByPoint","b","sortByRectPoint","lineA","lineB","PAGE_TEMPLATE","approximateFraction","floor","xinv","x_","q","roundToDivide","div","disableEdit","enableEdit","disablePen","enablePen","setPen","penSize","penColor","parseFloat","disablePoint","enablePoint","disableRect","enableRect","disableCircle","enableCircle","setCircle","circleRadius","circleColor","addCircle","oldType","disableArrow","enableArrow","setArrow","disableEraser","enableEraser","disableText","enableText","setText","textSize","textColor","createPage","children","canvas","mozOpaque","renderPage","renderOptions","pdfDocument","eventBus","pdfjsViewer","EventBus","all","getPage","_ref","_ref2","_slicedToArray","pdfPage","canvasContext","getContext","alpha","totalRotation","getViewport","wrapper","outputScale","ctx","devicePixelRatio","backingStoreRatio","webkitBackingStorePixelRatio","mozBackingStorePixelRatio","msBackingStorePixelRatio","oBackingStorePixelRatio","backingStorePixelRatio","pixelRatio","sx","sy","scaled","sfx","sfy","visibility","scalePage","render","promise","getTextContent","normalizeWhitespace","textLayerBuilder","DefaultTextLayerFactory","createTextLayerBuilder","setTextContent","__storeAdapter","setStoreAdapter","adapter","UI","data","removeAttribute","_this$getStoreAdapter"],"mappings":"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","file":"pdf-annotate.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"PDFAnnotate\"] = factory();\n\telse\n\t\troot[\"PDFAnnotate\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 1);\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar R = typeof Reflect === 'object' ? Reflect : null\nvar ReflectApply = R && typeof R.apply === 'function'\n  ? R.apply\n  : function ReflectApply(target, receiver, args) {\n    return Function.prototype.apply.call(target, receiver, args);\n  }\n\nvar ReflectOwnKeys\nif (R && typeof R.ownKeys === 'function') {\n  ReflectOwnKeys = R.ownKeys\n} else if (Object.getOwnPropertySymbols) {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target)\n      .concat(Object.getOwnPropertySymbols(target));\n  };\n} else {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target);\n  };\n}\n\nfunction ProcessEmitWarning(warning) {\n  if (console && console.warn) console.warn(warning);\n}\n\nvar NumberIsNaN = Number.isNaN || function NumberIsNaN(value) {\n  return value !== value;\n}\n\nfunction EventEmitter() {\n  EventEmitter.init.call(this);\n}\nmodule.exports = EventEmitter;\nmodule.exports.once = once;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._eventsCount = 0;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nvar defaultMaxListeners = 10;\n\nfunction checkListener(listener) {\n  if (typeof listener !== 'function') {\n    throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n  }\n}\n\nObject.defineProperty(EventEmitter, 'defaultMaxListeners', {\n  enumerable: true,\n  get: function() {\n    return defaultMaxListeners;\n  },\n  set: function(arg) {\n    if (typeof arg !== 'number' || arg < 0 || NumberIsNaN(arg)) {\n      throw new RangeError('The value of \"defaultMaxListeners\" is out of range. It must be a non-negative number. Received ' + arg + '.');\n    }\n    defaultMaxListeners = arg;\n  }\n});\n\nEventEmitter.init = function() {\n\n  if (this._events === undefined ||\n      this._events === Object.getPrototypeOf(this)._events) {\n    this._events = Object.create(null);\n    this._eventsCount = 0;\n  }\n\n  this._maxListeners = this._maxListeners || undefined;\n};\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function setMaxListeners(n) {\n  if (typeof n !== 'number' || n < 0 || NumberIsNaN(n)) {\n    throw new RangeError('The value of \"n\" is out of range. It must be a non-negative number. Received ' + n + '.');\n  }\n  this._maxListeners = n;\n  return this;\n};\n\nfunction _getMaxListeners(that) {\n  if (that._maxListeners === undefined)\n    return EventEmitter.defaultMaxListeners;\n  return that._maxListeners;\n}\n\nEventEmitter.prototype.getMaxListeners = function getMaxListeners() {\n  return _getMaxListeners(this);\n};\n\nEventEmitter.prototype.emit = function emit(type) {\n  var args = [];\n  for (var i = 1; i < arguments.length; i++) args.push(arguments[i]);\n  var doError = (type === 'error');\n\n  var events = this._events;\n  if (events !== undefined)\n    doError = (doError && events.error === undefined);\n  else if (!doError)\n    return false;\n\n  // If there is no 'error' event listener then throw.\n  if (doError) {\n    var er;\n    if (args.length > 0)\n      er = args[0];\n    if (er instanceof Error) {\n      // Note: The comments on the `throw` lines are intentional, they show\n      // up in Node's output if this results in an unhandled exception.\n      throw er; // Unhandled 'error' event\n    }\n    // At least give some kind of context to the user\n    var err = new Error('Unhandled error.' + (er ? ' (' + er.message + ')' : ''));\n    err.context = er;\n    throw err; // Unhandled 'error' event\n  }\n\n  var handler = events[type];\n\n  if (handler === undefined)\n    return false;\n\n  if (typeof handler === 'function') {\n    ReflectApply(handler, this, args);\n  } else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      ReflectApply(listeners[i], this, args);\n  }\n\n  return true;\n};\n\nfunction _addListener(target, type, listener, prepend) {\n  var m;\n  var events;\n  var existing;\n\n  checkListener(listener);\n\n  events = target._events;\n  if (events === undefined) {\n    events = target._events = Object.create(null);\n    target._eventsCount = 0;\n  } else {\n    // To avoid recursion in the case that type === \"newListener\"! Before\n    // adding it to the listeners, first emit \"newListener\".\n    if (events.newListener !== undefined) {\n      target.emit('newListener', type,\n                  listener.listener ? listener.listener : listener);\n\n      // Re-assign `events` because a newListener handler could have caused the\n      // this._events to be assigned to a new object\n      events = target._events;\n    }\n    existing = events[type];\n  }\n\n  if (existing === undefined) {\n    // Optimize the case of one listener. Don't need the extra array object.\n    existing = events[type] = listener;\n    ++target._eventsCount;\n  } else {\n    if (typeof existing === 'function') {\n      // Adding the second element, need to change to array.\n      existing = events[type] =\n        prepend ? [listener, existing] : [existing, listener];\n      // If we've already got an array, just append.\n    } else if (prepend) {\n      existing.unshift(listener);\n    } else {\n      existing.push(listener);\n    }\n\n    // Check for listener leak\n    m = _getMaxListeners(target);\n    if (m > 0 && existing.length > m && !existing.warned) {\n      existing.warned = true;\n      // No error code for this since it is a Warning\n      // eslint-disable-next-line no-restricted-syntax\n      var w = new Error('Possible EventEmitter memory leak detected. ' +\n                          existing.length + ' ' + String(type) + ' listeners ' +\n                          'added. Use emitter.setMaxListeners() to ' +\n                          'increase limit');\n      w.name = 'MaxListenersExceededWarning';\n      w.emitter = target;\n      w.type = type;\n      w.count = existing.length;\n      ProcessEmitWarning(w);\n    }\n  }\n\n  return target;\n}\n\nEventEmitter.prototype.addListener = function addListener(type, listener) {\n  return _addListener(this, type, listener, false);\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.prependListener =\n    function prependListener(type, listener) {\n      return _addListener(this, type, listener, true);\n    };\n\nfunction onceWrapper() {\n  if (!this.fired) {\n    this.target.removeListener(this.type, this.wrapFn);\n    this.fired = true;\n    if (arguments.length === 0)\n      return this.listener.call(this.target);\n    return this.listener.apply(this.target, arguments);\n  }\n}\n\nfunction _onceWrap(target, type, listener) {\n  var state = { fired: false, wrapFn: undefined, target: target, type: type, listener: listener };\n  var wrapped = onceWrapper.bind(state);\n  wrapped.listener = listener;\n  state.wrapFn = wrapped;\n  return wrapped;\n}\n\nEventEmitter.prototype.once = function once(type, listener) {\n  checkListener(listener);\n  this.on(type, _onceWrap(this, type, listener));\n  return this;\n};\n\nEventEmitter.prototype.prependOnceListener =\n    function prependOnceListener(type, listener) {\n      checkListener(listener);\n      this.prependListener(type, _onceWrap(this, type, listener));\n      return this;\n    };\n\n// Emits a 'removeListener' event if and only if the listener was removed.\nEventEmitter.prototype.removeListener =\n    function removeListener(type, listener) {\n      var list, events, position, i, originalListener;\n\n      checkListener(listener);\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      list = events[type];\n      if (list === undefined)\n        return this;\n\n      if (list === listener || list.listener === listener) {\n        if (--this._eventsCount === 0)\n          this._events = Object.create(null);\n        else {\n          delete events[type];\n          if (events.removeListener)\n            this.emit('removeListener', type, list.listener || listener);\n        }\n      } else if (typeof list !== 'function') {\n        position = -1;\n\n        for (i = list.length - 1; i >= 0; i--) {\n          if (list[i] === listener || list[i].listener === listener) {\n            originalListener = list[i].listener;\n            position = i;\n            break;\n          }\n        }\n\n        if (position < 0)\n          return this;\n\n        if (position === 0)\n          list.shift();\n        else {\n          spliceOne(list, position);\n        }\n\n        if (list.length === 1)\n          events[type] = list[0];\n\n        if (events.removeListener !== undefined)\n          this.emit('removeListener', type, originalListener || listener);\n      }\n\n      return this;\n    };\n\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\n\nEventEmitter.prototype.removeAllListeners =\n    function removeAllListeners(type) {\n      var listeners, events, i;\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      // not listening for removeListener, no need to emit\n      if (events.removeListener === undefined) {\n        if (arguments.length === 0) {\n          this._events = Object.create(null);\n          this._eventsCount = 0;\n        } else if (events[type] !== undefined) {\n          if (--this._eventsCount === 0)\n            this._events = Object.create(null);\n          else\n            delete events[type];\n        }\n        return this;\n      }\n\n      // emit removeListener for all listeners on all events\n      if (arguments.length === 0) {\n        var keys = Object.keys(events);\n        var key;\n        for (i = 0; i < keys.length; ++i) {\n          key = keys[i];\n          if (key === 'removeListener') continue;\n          this.removeAllListeners(key);\n        }\n        this.removeAllListeners('removeListener');\n        this._events = Object.create(null);\n        this._eventsCount = 0;\n        return this;\n      }\n\n      listeners = events[type];\n\n      if (typeof listeners === 'function') {\n        this.removeListener(type, listeners);\n      } else if (listeners !== undefined) {\n        // LIFO order\n        for (i = listeners.length - 1; i >= 0; i--) {\n          this.removeListener(type, listeners[i]);\n        }\n      }\n\n      return this;\n    };\n\nfunction _listeners(target, type, unwrap) {\n  var events = target._events;\n\n  if (events === undefined)\n    return [];\n\n  var evlistener = events[type];\n  if (evlistener === undefined)\n    return [];\n\n  if (typeof evlistener === 'function')\n    return unwrap ? [evlistener.listener || evlistener] : [evlistener];\n\n  return unwrap ?\n    unwrapListeners(evlistener) : arrayClone(evlistener, evlistener.length);\n}\n\nEventEmitter.prototype.listeners = function listeners(type) {\n  return _listeners(this, type, true);\n};\n\nEventEmitter.prototype.rawListeners = function rawListeners(type) {\n  return _listeners(this, type, false);\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  if (typeof emitter.listenerCount === 'function') {\n    return emitter.listenerCount(type);\n  } else {\n    return listenerCount.call(emitter, type);\n  }\n};\n\nEventEmitter.prototype.listenerCount = listenerCount;\nfunction listenerCount(type) {\n  var events = this._events;\n\n  if (events !== undefined) {\n    var evlistener = events[type];\n\n    if (typeof evlistener === 'function') {\n      return 1;\n    } else if (evlistener !== undefined) {\n      return evlistener.length;\n    }\n  }\n\n  return 0;\n}\n\nEventEmitter.prototype.eventNames = function eventNames() {\n  return this._eventsCount > 0 ? ReflectOwnKeys(this._events) : [];\n};\n\nfunction arrayClone(arr, n) {\n  var copy = new Array(n);\n  for (var i = 0; i < n; ++i)\n    copy[i] = arr[i];\n  return copy;\n}\n\nfunction spliceOne(list, index) {\n  for (; index + 1 < list.length; index++)\n    list[index] = list[index + 1];\n  list.pop();\n}\n\nfunction unwrapListeners(arr) {\n  var ret = new Array(arr.length);\n  for (var i = 0; i < ret.length; ++i) {\n    ret[i] = arr[i].listener || arr[i];\n  }\n  return ret;\n}\n\nfunction once(emitter, name) {\n  return new Promise(function (resolve, reject) {\n    function errorListener(err) {\n      emitter.removeListener(name, resolver);\n      reject(err);\n    }\n\n    function resolver() {\n      if (typeof emitter.removeListener === 'function') {\n        emitter.removeListener('error', errorListener);\n      }\n      resolve([].slice.call(arguments));\n    };\n\n    eventTargetAgnosticAddListener(emitter, name, resolver, { once: true });\n    if (name !== 'error') {\n      addErrorHandlerIfEventEmitter(emitter, errorListener, { once: true });\n    }\n  });\n}\n\nfunction addErrorHandlerIfEventEmitter(emitter, handler, flags) {\n  if (typeof emitter.on === 'function') {\n    eventTargetAgnosticAddListener(emitter, 'error', handler, flags);\n  }\n}\n\nfunction eventTargetAgnosticAddListener(emitter, name, listener, flags) {\n  if (typeof emitter.on === 'function') {\n    if (flags.once) {\n      emitter.once(name, listener);\n    } else {\n      emitter.on(name, listener);\n    }\n  } else if (typeof emitter.addEventListener === 'function') {\n    // EventTarget does not have `error` event semantics like Node\n    // EventEmitters, we do not listen for `error` events here.\n    emitter.addEventListener(name, function wrapListener(arg) {\n      // IE does not have builtin `{ once: true }` support so we\n      // have to do it manually.\n      if (flags.once) {\n        emitter.removeEventListener(name, wrapListener);\n      }\n      listener(arg);\n    });\n  } else {\n    throw new TypeError('The \"emitter\" argument must be of type EventEmitter. Received type ' + typeof emitter);\n  }\n}\n","/**\r\n * Throw an Error for an abstract function that hasn't been implemented.\r\n *\r\n * @param {String} name The name of the abstract function\r\n */\r\nexport default function abstractFunction(name) {\r\n  throw new Error(name + ' is not implemented');\r\n}\r\n","const UPPER_REGEX = /[A-Z]/g;\r\n\r\n// Don't convert these attributes from camelCase to hyphenated-attributes\r\nconst BLACKLIST = [\r\n  'viewBox'\r\n];\r\n\r\nlet keyCase = (key) => {\r\n  if (BLACKLIST.indexOf(key) === -1) {\r\n    key = key.replace(UPPER_REGEX, match => '-' + match.toLowerCase());\r\n  }\r\n  return key;\r\n};\r\n\r\n/**\r\n * Set attributes for a node from a map\r\n *\r\n * @param {Node} node The node to set attributes on\r\n * @param {Object} attributes The map of key/value pairs to use for attributes\r\n */\r\nexport default function setAttributes(node, attributes) {\r\n  Object.keys(attributes).forEach((key) => {\r\n    node.setAttribute(keyCase(key), attributes[key]);\r\n  });\r\n}\r\n","const REGEX_HASHLESS_HEX = /^([a-f0-9]{6}|[a-f0-9]{3})$/i;\r\n\r\n/**\r\n * Normalize a color value\r\n *\r\n * @param {String} color The color to normalize\r\n * @return {String}\r\n */\r\nexport default function normalizeColor(color) {\r\n  if (REGEX_HASHLESS_HEX.test(color)) {\r\n    color = `#${color}`;\r\n  }\r\n  return color;\r\n}\r\n","import setAttributes from '../utils/setAttributes';\r\nimport normalizeColor from '../utils/normalizeColor';\r\n\r\n/**\r\n * Create SVGRectElements from an annotation definition.\r\n * This is used for anntations of type `area` and `highlight`.\r\n *\r\n * @param {Object} a The annotation definition\r\n * @return {SVGGElement|SVGRectElement} A group of all rects to be rendered\r\n */\r\nexport default function renderRect(a) {\r\n  if (a.type === 'highlight') {\r\n    let group = document.createElementNS('http://www.w3.org/2000/svg', 'g');\r\n    setAttributes(group, {\r\n      fill: normalizeColor(a.color || '#ff0'),\r\n      fillOpacity: 0.2\r\n    });\r\n\r\n    a.rectangles.forEach((r) => {\r\n      group.appendChild(createRect(r));\r\n    });\r\n\r\n    return group;\r\n  }\r\n  else {\r\n    let rect = createRect(a);\r\n    setAttributes(rect, {\r\n      stroke: normalizeColor(a.color || '#f00'),\r\n      fill: 'none'\r\n    });\r\n\r\n    return rect;\r\n  }\r\n}\r\n\r\nfunction createRect(r) {\r\n  let rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');\r\n\r\n  setAttributes(rect, {\r\n    x: r.x,\r\n    y: r.y,\r\n    width: r.width,\r\n    height: r.height\r\n  });\r\n\r\n  return rect;\r\n}\r\n","import setAttributes from '../utils/setAttributes';\r\nimport normalizeColor from '../utils/normalizeColor';\r\n\r\n/**\r\n * Wrap each line of given text in a `<tspan>` element and append these\r\n * lines to the given SVGTextElement\r\n *\r\n * @param {SVGTextElement} textElement A text element to hold the split text\r\n * @param {String} textContent String to render with line breaks\r\n */\r\nfunction insertLineBreaks(textElement, textContent) {\r\n  const lines = (textContent || '').split('\\n');\r\n  // can't use dy attribute here since we want empty lines to take up space as well,\r\n  // so we will update y manually based on font size\r\n  const x = textElement.getAttribute('x');\r\n  let y = Number(textElement.getAttribute('y'));\r\n  const size = Number(textElement.getAttribute('font-size'));\r\n  for (const line of lines) {\r\n    const tspan = document.createElementNS('http://www.w3.org/2000/svg', 'tspan');\r\n    tspan.setAttribute('y', y.toString());\r\n    tspan.setAttribute('x', x);\r\n    tspan.innerHTML = line;\r\n    textElement.appendChild(tspan);\r\n\r\n    y += size;\r\n  }\r\n}\r\n\r\n/**\r\n * Create SVGTextElement from an annotation definition.\r\n * This is used for anntations of type `textbox`.\r\n *\r\n * @param {Object} a The annotation definition\r\n * @return {SVGTextElement} A text to be rendered\r\n */\r\nexport default function renderText(a) {\r\n  // Text should be rendered at 0 degrees relative to\r\n  // document rotation\r\n  let text = document.createElementNS('http://www.w3.org/2000/svg', 'text');\r\n  setAttributes(text, {\r\n    x: a.x,\r\n    y: a.y,\r\n    fill: normalizeColor(a.color || '#000'),\r\n    fontSize: a.size,\r\n    transform: `rotate(${a.rotation})`,\r\n    style: 'white-space: pre'\r\n  });\r\n\r\n  insertLineBreaks(text, a.content);\r\n\r\n  let g = document.createElementNS('http://www.w3.org/2000/svg', 'g');\r\n  g.appendChild(text);\r\n\r\n  return g;\r\n}\r\n","import setAttributes from '../utils/setAttributes';\r\nimport normalizeColor from '../utils/normalizeColor';\r\n\r\n/**\r\n * Create an SVGCircleElement from an annotation definition.\r\n * This is used for annotations of type `circle`.\r\n *\r\n * @param {Object} a The annotation definition\r\n * @return {SVGGElement|SVGCircleElement} A circle to be rendered\r\n */\r\nexport default function renderCircle(a) {\r\n  let circle = createCircle(a);\r\n  let color = normalizeColor(a.color || '#f00');\r\n\r\n  if (a.type === 'circle') {\r\n    setAttributes(circle, {\r\n      stroke: color,\r\n      fill: 'none',\r\n      'stroke-width': 5\r\n    });\r\n  }\r\n  if (a.type === 'emptycircle') {\r\n    setAttributes(circle, {\r\n      stroke: color,\r\n      fill: 'none',\r\n      'stroke-width': 2\r\n    });\r\n  }\r\n\r\n  if (a.type === 'fillcircle') {\r\n    setAttributes(circle, {\r\n      stroke: color,\r\n      fill: color,\r\n      'stroke-width': 5\r\n    });\r\n  }\r\n\r\n  return circle;\r\n}\r\n\r\nfunction createCircle(a) {\r\n  let circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');\r\n  setAttributes(circle, {\r\n    cx: a.cx,\r\n    cy: a.cy,\r\n    r: a.r\r\n  });\r\n\r\n  return circle;\r\n}\r\n","// Transform point by matrix\r\n//\r\nexport function applyTransform(p, m) {\r\n  return [\r\n    p[0] * m[0] + p[1] * m[2] + m[4],\r\n    p[0] * m[1] + p[1] * m[3] + m[5]\r\n  ];\r\n};\r\n\r\n// Transform point by matrix inverse\r\n//\r\nexport function applyInverseTransform(p, m) {\r\n  let d = m[0] * m[3] - m[1] * m[2];\r\n  return [\r\n    (p[0] * m[3] - p[1] * m[2] + m[2] * m[5] - m[4] * m[3]) / d,\r\n    (-p[0] * m[1] + p[1] * m[0] + m[4] * m[1] - m[5] * m[0]) / d\r\n  ];\r\n};\r\n\r\n// Concatenates two transformation matrices together and returns the result.\r\nexport function transform(m1, m2) {\r\n  return [\r\n    m1[0] * m2[0] + m1[2] * m2[1],\r\n    m1[1] * m2[0] + m1[3] * m2[1],\r\n    m1[0] * m2[2] + m1[2] * m2[3],\r\n    m1[1] * m2[2] + m1[3] * m2[3],\r\n    m1[0] * m2[4] + m1[2] * m2[5] + m1[4],\r\n    m1[1] * m2[4] + m1[3] * m2[5] + m1[5]\r\n  ];\r\n};\r\n\r\nexport function translate(m, x, y) {\r\n  return [\r\n    m[0],\r\n    m[1],\r\n    m[2],\r\n    m[3],\r\n    m[0] * x + m[2] * y + m[4],\r\n    m[1] * x + m[3] * y + m[5]\r\n  ];\r\n};\r\n\r\nexport function rotate(m, angle) {\r\n  angle = angle * Math.PI / 180;\r\n\r\n  let cosValue = Math.cos(angle);\r\n  let sinValue = Math.sin(angle);\r\n\r\n  return [\r\n    m[0] * cosValue + m[2] * sinValue,\r\n    m[1] * cosValue + m[3] * sinValue,\r\n    m[0] * (-sinValue) + m[2] * cosValue,\r\n    m[1] * (-sinValue) + m[3] * cosValue,\r\n    m[4],\r\n    m[5]\r\n  ];\r\n};\r\n\r\nexport function scale(m, x, y) {\r\n  return [\r\n    m[0] * x,\r\n    m[1] * x,\r\n    m[2] * y,\r\n    m[3] * y,\r\n    m[4],\r\n    m[5]\r\n  ];\r\n};\r\n\r\nexport function makePoint(x, y, z) {\r\n  return { x: x, y: y, z: z };\r\n};\r\n\r\nexport function makeVector(xcoord, ycoord, zcoord) {\r\n  return { xcoord: xcoord, ycoord: ycoord, zcoord: zcoord };\r\n};\r\n\r\nexport function makeVectorFromPoints(pt1, pt2) {\r\n  let xcoord = pt2.x - pt1.x;\r\n  let ycoord = pt2.y - pt1.y;\r\n  let zcoord = pt2.z - pt1.z;\r\n  return makeVector(xcoord, ycoord, zcoord);\r\n};\r\n\r\nexport function addVector(pt, v) {\r\n  return makePoint(pt.x + v.xcoord, pt.y + v.ycoord, pt.z + v.zcoord);\r\n};\r\n\r\nexport function multiplyVector(v, scalar) {\r\n  return makeVector(v.xcoord * scalar, v.ycoord * scalar, v.zcoord * scalar);\r\n};\r\n\r\nexport function magnitude(v) {\r\n  return Math.sqrt(\r\n    Math.pow(v.xcoord, 2) + Math.pow(v.ycoord, 2) + Math.pow(v.zcoord, 2)\r\n  );\r\n};\r\n\r\nexport function negateVector(v) {\r\n  return multiplyVector(v, -1);\r\n};\r\n\r\nexport function unitVector(v) {\r\n  let mag = magnitude(v);\r\n  let xcoord = v.xcoord / mag;\r\n  let ycoord = v.ycoord / mag;\r\n  let zcoord = v.zcoord / mag;\r\n  return makeVector(xcoord, ycoord, zcoord);\r\n};\r\n\r\nexport function crossProduct(u, v) {\r\n  //\r\n  // u X v = < u2*v3 - u3*v2,\r\n  //           u3*v1 - u1*v3,\r\n  //           u1*v2 - u2*v1 >\r\n  let xcoord = u.ycoord * v.zcoord - u.zcoord * v.ycoord;\r\n  let ycoord = u.zcoord * v.xcoord - u.xcoord * v.zcoord;\r\n  let zcoord = u.xcoord * v.ycoord - u.ycoord * v.xcoord;\r\n  return makeVector(xcoord, ycoord, zcoord);\r\n};\r\n","import setAttributes from '../utils/setAttributes';\r\nimport normalizeColor from '../utils/normalizeColor';\r\nimport {\r\n  makePoint, makeVector, makeVectorFromPoints,\r\n  magnitude, unitVector, crossProduct,\r\n  addVector, multiplyVector, negateVector\r\n} from '../utils/mathUtils';\r\n\r\n/**\r\n * Create SVGPathElement from an annotation definition.\r\n * This is used for anntations of type `drawing`.\r\n *\r\n * @param {Object} a The annotation definition\r\n * @return {SVGPathElement} The path to be rendered\r\n */\r\nexport default function renderArrow(a) {\r\n  let arrow = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');\r\n\r\n  if (a.lines.length === 2) {\r\n    let p1 = a.lines[0];\r\n    let p2 = a.lines[a.lines.length - 1];\r\n\r\n    let arrowLength = 40;\r\n    let pt0 = makePoint(p1[0], p1[1], 0);\r\n    let pt1 = makePoint(p2[0], p2[1], 0);\r\n    let x = makeVectorFromPoints(pt0, pt1);\r\n    let unitX = unitVector(x);\r\n    pt1 = addVector(pt0, multiplyVector(unitX, arrowLength));\r\n    x = makeVectorFromPoints(pt0, pt1);\r\n    let unitZ = makeVector(0, 0, 1);\r\n    let unitY = unitVector(crossProduct(unitX, unitZ));\r\n    let thickness = a.width || 10;\r\n\r\n    let A = addVector(pt0, multiplyVector(unitY, thickness * 0.5));\r\n    let B = addVector(A, multiplyVector(unitX, magnitude(x) - thickness * 2.0));\r\n    let C = addVector(B, multiplyVector(unitY, thickness));\r\n    let D = pt1;\r\n    let G = addVector(pt0, multiplyVector(negateVector(unitY), thickness * 0.5));\r\n    let F = addVector(G, multiplyVector(unitX, magnitude(x) - thickness * 2.0));\r\n    let E = addVector(F, multiplyVector(negateVector(unitY), thickness));\r\n\r\n    let points = '' +\r\n      A.x + ',' + A.y + ' ' +\r\n      B.x + ',' + B.y + ' ' +\r\n      C.x + ',' + C.y + ' ' +\r\n      D.x + ',' + D.y + ' ' +\r\n      E.x + ',' + E.y + ' ' +\r\n      F.x + ',' + F.y + ' ' +\r\n      G.x + ',' + G.y;\r\n\r\n    setAttributes(arrow, {\r\n      points: points,\r\n      stroke: normalizeColor(a.color || '#000'),\r\n      fill: normalizeColor(a.color || '#000')\r\n    });\r\n  }\r\n\r\n  return arrow;\r\n}\r\n","import renderLine from './renderLine';\r\nimport renderPath from './renderPath';\r\nimport renderPoint from './renderPoint';\r\nimport renderRect from './renderRect';\r\nimport renderText from './renderText';\r\nimport renderCircle from './renderCircle';\r\nimport renderArrow from './renderArrow';\r\n\r\nconst isFirefox = /firefox/i.test(navigator.userAgent);\r\n\r\n/**\r\n * Get the x/y translation to be used for transforming the annotations\r\n * based on the rotation of the viewport.\r\n *\r\n * @param {Object} viewport The viewport data from the page\r\n * @return {Object}\r\n */\r\nexport function getTranslation(viewport) {\r\n  let x;\r\n  let y;\r\n\r\n  // Modulus 360 on the rotation so that we only\r\n  // have to worry about four possible values.\r\n  switch (viewport.rotation % 360) {\r\n    case 0:\r\n      x = y = 0;\r\n      break;\r\n    case 90:\r\n      x = 0;\r\n      y = (viewport.width / viewport.scale) * -1;\r\n      break;\r\n    case 180:\r\n      x = (viewport.width / viewport.scale) * -1;\r\n      y = (viewport.height / viewport.scale) * -1;\r\n      break;\r\n    case 270:\r\n      x = (viewport.height / viewport.scale) * -1;\r\n      y = 0;\r\n      break;\r\n  }\r\n\r\n  return { x, y };\r\n}\r\n\r\n/**\r\n * Transform the rotation and scale of a node using SVG's native transform attribute.\r\n *\r\n * @param {Node} node The node to be transformed\r\n * @param {Object} viewport The page's viewport data\r\n * @return {Node}\r\n */\r\nfunction transform(node, viewport) {\r\n  let trans = getTranslation(viewport);\r\n\r\n  // Let SVG natively transform the element\r\n  node.setAttribute('transform', `scale(${viewport.scale}) rotate(${viewport.rotation}) translate(${trans.x}, ${trans.y})`);\r\n\r\n  // Manually adjust x/y for nested SVG nodes\r\n  if (!isFirefox && node.nodeName.toLowerCase() === 'svg') {\r\n    node.setAttribute('x', parseInt(node.getAttribute('x'), 10) * viewport.scale);\r\n    node.setAttribute('y', parseInt(node.getAttribute('y'), 10) * viewport.scale);\r\n\r\n    let x = parseInt(node.getAttribute('x', 10));\r\n    let y = parseInt(node.getAttribute('y', 10));\r\n    let width = parseInt(node.getAttribute('width'), 10);\r\n    let height = parseInt(node.getAttribute('height'), 10);\r\n    let path = node.querySelector('path');\r\n    let svg = path.parentNode;\r\n\r\n    // Scale width/height\r\n    [node, svg, path, node.querySelector('rect')].forEach((n) => {\r\n      n.setAttribute('width', parseInt(n.getAttribute('width'), 10) * viewport.scale);\r\n      n.setAttribute('height', parseInt(n.getAttribute('height'), 10) * viewport.scale);\r\n    });\r\n\r\n    // Transform path but keep scale at 100% since it will be handled natively\r\n    transform(path, Object.assign({}, viewport, { scale: 1 }));\r\n\r\n    switch (viewport.rotation % 360) {\r\n      case 90:\r\n        node.setAttribute('x', viewport.width - y - width);\r\n        node.setAttribute('y', x);\r\n        svg.setAttribute('x', 1);\r\n        svg.setAttribute('y', 0);\r\n        break;\r\n      case 180:\r\n        node.setAttribute('x', viewport.width - x - width);\r\n        node.setAttribute('y', viewport.height - y - height);\r\n        svg.setAttribute('y', 2);\r\n        break;\r\n      case 270:\r\n        node.setAttribute('x', y);\r\n        node.setAttribute('y', viewport.height - x - height);\r\n        svg.setAttribute('x', -1);\r\n        svg.setAttribute('y', 0);\r\n        break;\r\n    }\r\n  }\r\n\r\n  return node;\r\n}\r\n\r\n/**\r\n * Append an annotation as a child of an SVG.\r\n *\r\n * @param {SVGElement} svg The SVG element to append the annotation to\r\n * @param {Object} annotation The annotation definition to render and append\r\n * @param {Object} viewport The page's viewport data\r\n * @return {SVGElement} A node that was created and appended by this function\r\n */\r\nexport function appendChild(svg, annotation, viewport) {\r\n  if (!viewport) {\r\n    viewport = JSON.parse(svg.getAttribute('data-pdf-annotate-viewport'));\r\n  }\r\n\r\n  let child;\r\n  switch (annotation.type) {\r\n    case 'area':\r\n    case 'highlight':\r\n      child = renderRect(annotation);\r\n      break;\r\n    case 'circle':\r\n    case 'fillcircle':\r\n    case 'emptycircle':\r\n      child = renderCircle(annotation);\r\n      break;\r\n    case 'strikeout':\r\n      child = renderLine(annotation);\r\n      break;\r\n    case 'point':\r\n      child = renderPoint(annotation);\r\n      break;\r\n    case 'textbox':\r\n      child = renderText(annotation);\r\n      break;\r\n    case 'drawing':\r\n      child = renderPath(annotation);\r\n      break;\r\n    case 'arrow':\r\n      child = renderArrow(annotation);\r\n      break;\r\n  }\r\n\r\n  // If no type was provided for an annotation it will result in node being null.\r\n  // Skip appending/transforming if node doesn't exist.\r\n  if (child) {\r\n    // Set attributes\r\n    child.setAttribute('data-pdf-annotate-id', annotation.uuid);\r\n    child.setAttribute('aria-hidden', true);\r\n\r\n    // Dynamically set any other attributes associated with annotation that is not related to drawing it\r\n    Object.keys(annotation).filter((key) => {\r\n      return ['color', 'x', 'y', 'cx', 'cy', 'color', 'documentId', 'lines', 'page',\r\n        'width', 'class', 'content', 'size', 'rotation', 'r'].indexOf(key) === -1;\r\n    }).forEach((key) => {\r\n      child.setAttribute(`data-pdf-annotate-${key}`, annotation[key]);\r\n    });\r\n\r\n    svg.appendChild(transform(child, viewport));\r\n  }\r\n\r\n  return child;\r\n}\r\n\r\n/**\r\n * Transform a child annotation of an SVG.\r\n *\r\n * @param {SVGElement} svg The SVG element with the child annotation\r\n * @param {Object} child The SVG child to transform\r\n * @param {Object} viewport The page's viewport data\r\n * @return {SVGElement} A node that was transformed by this function\r\n */\r\nexport function transformChild(svg, child, viewport) {\r\n  if (!viewport) {\r\n    viewport = JSON.parse(svg.getAttribute('data-pdf-annotate-viewport'));\r\n  }\r\n\r\n  // If no type was provided for an annotation it will result in node being null.\r\n  // Skip transforming if node doesn't exist.\r\n  if (child) {\r\n    child = transform(child, viewport);\r\n  }\r\n\r\n  return child;\r\n}\r\n\r\nexport default {\r\n  /**\r\n   * Get the x/y translation to be used for transforming the annotations\r\n   * based on the rotation of the viewport.\r\n   */\r\n  getTranslation,\r\n\r\n  /**\r\n   * Append an SVG child for an annotation\r\n   */\r\n  appendChild,\r\n\r\n  /**\r\n   * Transform an existing SVG child\r\n   */\r\n  transformChild\r\n};\r\n","import setAttributes from '../utils/setAttributes';\r\nimport normalizeColor from '../utils/normalizeColor';\r\n\r\n/**\r\n * Create SVGLineElements from an annotation definition.\r\n * This is used for anntations of type `strikeout`.\r\n *\r\n * @param {Object} a The annotation definition\r\n * @return {SVGGElement} A group of all lines to be rendered\r\n */\r\nexport default function renderLine(a) {\r\n  let group = document.createElementNS('http://www.w3.org/2000/svg', 'g');\r\n  setAttributes(group, {\r\n    stroke: normalizeColor(a.color || '#f00'),\r\n    strokeWidth: 1\r\n  });\r\n\r\n  a.rectangles.forEach((r) => {\r\n    let line = document.createElementNS('http://www.w3.org/2000/svg', 'line');\r\n\r\n    setAttributes(line, {\r\n      x1: r.x,\r\n      y1: r.y,\r\n      x2: r.x + r.width,\r\n      y2: r.y\r\n    });\r\n\r\n    group.appendChild(line);\r\n  });\r\n\r\n  return group;\r\n}\r\n","import setAttributes from '../utils/setAttributes';\r\n\r\nconst SIZE = 25;\r\nconst D = 'M499.968 214.336q-113.832 0 -212.877 38.781t-157.356 104.625 -58.311 142.29q0 62.496 39.897 119.133t112.437 97.929l48.546 27.9 -15.066 53.568q-13.392 50.778 -39.06 95.976 84.816 -35.154 153.45 -95.418l23.994 -21.204 31.806 3.348q38.502 4.464 72.54 4.464 113.832 0 212.877 -38.781t157.356 -104.625 58.311 -142.29 -58.311 -142.29 -157.356 -104.625 -212.877 -38.781z';\r\n\r\n/**\r\n * Create SVGElement from an annotation definition.\r\n * This is used for anntations of type `comment`.\r\n *\r\n * @param {Object} a The annotation definition\r\n * @return {SVGElement} A svg to be rendered\r\n */\r\nexport default function renderPoint(a) {\r\n  let outerSVG = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\r\n  let innerSVG = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\r\n  let rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');\r\n  let path = document.createElementNS('http://www.w3.org/2000/svg', 'path');\r\n\r\n  setAttributes(outerSVG, {\r\n    width: SIZE,\r\n    height: SIZE,\r\n    x: a.x,\r\n    y: a.y\r\n  });\r\n\r\n  setAttributes(innerSVG, {\r\n    width: SIZE,\r\n    height: SIZE,\r\n    x: 0,\r\n    y: (SIZE * 0.05) * -1,\r\n    viewBox: '0 0 1000 1000'\r\n  });\r\n\r\n  setAttributes(rect, {\r\n    width: SIZE,\r\n    height: SIZE,\r\n    stroke: '#000',\r\n    fill: '#ff0'\r\n  });\r\n\r\n  setAttributes(path, {\r\n    d: D,\r\n    strokeWidth: 50,\r\n    stroke: '#000',\r\n    fill: '#fff'\r\n  });\r\n\r\n  innerSVG.appendChild(path);\r\n  outerSVG.appendChild(rect);\r\n  outerSVG.appendChild(innerSVG);\r\n\r\n  return outerSVG;\r\n}\r\n","import setAttributes from '../utils/setAttributes';\r\nimport normalizeColor from '../utils/normalizeColor';\r\n\r\n/**\r\n * Create SVGPathElement from an annotation definition.\r\n * This is used for anntations of type `drawing`.\r\n *\r\n * @param {Object} a The annotation definition\r\n * @return {SVGPathElement} The path to be rendered\r\n */\r\nexport default function renderPath(a) {\r\n  let d = [];\r\n  let path = document.createElementNS('http://www.w3.org/2000/svg', 'path');\r\n\r\n  if (a.lines.length > 0) {\r\n    d.push(`M${a.lines[0][0]} ${a.lines[0][1]}`);\r\n    for (let i = 1, l = a.lines.length; i < l; i++) {\r\n      let p1 = a.lines[i];\r\n      let p2 = a.lines[i + 1];\r\n      if (p2) {\r\n        d.push(`L${p1[0]} ${p1[1]}`);\r\n      }\r\n    }\r\n  }\r\n\r\n  /*\r\n\r\n   if(a.lines.length>2) {\r\n    var p1 = a.lines[0];\r\n    var p2 = a.lines[a.lines.length-1];\r\n\r\n    var p3 = []; //arrow\r\n    var p4 = [];\r\n    var p0 = []; //arrow intersection\r\n\r\n    if (p2) {\r\n      var k = -(p2[0]-p1[0])/(p2[1]-p1[1]);\r\n\r\n      var deltaX = 3;\r\n      p0[0] = p1[0]+0.8*(p2[0]-p1[0]);\r\n      p0[1] = p1[1]+0.8*(p2[1]-p1[1]);\r\n\r\n      p3[0] = p0[0] + deltaX;\r\n      p3[1] = p0[1] + k*deltaX;\r\n\r\n      p4[0] = p0[0] - deltaX;\r\n      p4[1] = p0[1] - k*deltaX;\r\n\r\n      if(Math.abs(p2[1]-p1[1]) < 20) {\r\n\r\n        p3[0] = p0[0] ;\r\n        p3[1] = p0[1] + deltaX*1;\r\n\r\n        p4[0] = p0[0] ;\r\n        p4[1] = p0[1] - deltaX*1;\r\n\r\n      }\r\n\r\n      d.push(`M${p1[0]} ${p1[1]} ${p2[0]} ${p2[1]}`);\r\n       //d.push(`M${p1[0]} ${p1[1]} ${p2[0]} ${p2[1]}`);\r\n      d.push(`M${p2[0]} ${p2[1]} ${p3[0]} ${p3[1]}`);\r\n      d.push(`M${p3[0]} ${p3[1]} ${p4[0]} ${p4[1]}`);\r\n      d.push(`M${p4[0]} ${p4[1]} ${p2[0]} ${p2[1]}`);\r\n     }\r\n    } */\r\n\r\n  setAttributes(path, {\r\n    d: `${d.join(' ')}`, // `${d.join(' ')}Z`,\r\n    stroke: normalizeColor(a.color || '#000'),\r\n    strokeWidth: a.width || 1,\r\n    fill: 'none'\r\n  });\r\n\r\n  return path;\r\n}\r\n","import { getTranslation } from '../render/appendChild';\r\nimport {\r\n  applyTransform,\r\n  applyInverseTransform,\r\n  translate,\r\n  rotate,\r\n  scale\r\n} from '../utils/mathUtils';\r\n\r\nexport const BORDER_COLOR = '#00BFFF';\r\n\r\nconst userSelectStyleSheet = document.createElement('style');\r\nuserSelectStyleSheet.innerHTML = `\r\nbody {\r\n  -webkit-user-select: none;\r\n  -moz-user-select: none;\r\n  -ms-user-select: none;\r\n  user-select: none;\r\n}\r\n`;\r\n\r\nuserSelectStyleSheet.setAttribute('data-pdf-annotate-user-select', 'true');\r\n\r\n/**\r\n * Find the SVGElement that contains all the annotations for a page\r\n *\r\n * @param {Element} node An annotation within that container\r\n * @return {SVGElement} The container SVG or null if it can't be found\r\n */\r\nexport function findSVGContainer(node) {\r\n  let parentNode = node;\r\n\r\n  while ((parentNode = parentNode.parentNode) &&\r\n          parentNode !== document) {\r\n    if (parentNode.nodeName.toUpperCase() === 'SVG' &&\r\n        parentNode.getAttribute('data-pdf-annotate-container') === 'true') {\r\n      return parentNode;\r\n    }\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\n/**\r\n * Find an SVGElement container at a given point\r\n *\r\n * @param {Number} x The x coordinate of the point\r\n * @param {Number} y The y coordinate of the point\r\n * @return {SVGElement} The container SVG or null if one can't be found\r\n */\r\nexport function findSVGAtPoint(x, y) {\r\n  let elements = document.querySelectorAll('svg[data-pdf-annotate-container=\"true\"]');\r\n\r\n  for (let i = 0, l = elements.length; i < l; i++) {\r\n    let el = elements[i];\r\n    let rect = el.getBoundingClientRect();\r\n\r\n    if (pointIntersectsRect(x, y, rect)) {\r\n      return el;\r\n    }\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\n/**\r\n * Find an Element that represents an annotation at a given point.\r\n *\r\n * IMPORTANT: Requires the annotation layer to be the top most element so\r\n *            either use z-ordering or make it the leaf container.\r\n *\r\n * @param {Number} x The x coordinate of the point\r\n * @param {Number} y The y coordinate of the point\r\n * @return {Element} The annotation element or null if one can't be found\r\n */\r\nexport function findAnnotationAtPoint(x, y) {\r\n  let el = null;\r\n  let candidate = document.elementFromPoint(x, y);\r\n  while (!el && candidate && candidate !== document) {\r\n    let type = candidate.getAttribute('data-pdf-annotate-type');\r\n    if (type) {\r\n      el = candidate;\r\n    }\r\n    candidate = candidate.parentNode;\r\n  }\r\n  return el;\r\n}\r\n\r\n/**\r\n * Determine if a point intersects a rect\r\n *\r\n * @param {Number} x The x coordinate of the point\r\n * @param {Number} y The y coordinate of the point\r\n * @param {Object} rect The points of a rect (likely from getBoundingClientRect)\r\n * @return {Boolean} True if a collision occurs, otherwise false\r\n */\r\nexport function pointIntersectsRect(x, y, rect) {\r\n  return y >= rect.top && y <= rect.bottom && x >= rect.left && x <= rect.right;\r\n}\r\n\r\n/**\r\n * Get the rect of an annotation element accounting for offset.\r\n *\r\n * @param {Element} el The element to get the rect of\r\n * @return {Object} The dimensions of the element\r\n */\r\nexport function getOffsetAnnotationRect(el) {\r\n  let rect = el.getBoundingClientRect();\r\n  let { width, height } = rect;\r\n  let extraOffsetWidth = 0;\r\n  let extraOffsetHeight = 0;\r\n  if (['line', 'path'].indexOf(el.tagName.toLowerCase()) > -1 && el.getBBox) {\r\n    let bbox = el.getBBox();\r\n    extraOffsetWidth = (rect.width - bbox.width) / 2;\r\n    extraOffsetHeight = (rect.height - bbox.height) / 2;\r\n    width = bbox.width;\r\n    height = bbox.height;\r\n  }\r\n  let { offsetLeft, offsetTop } = getOffset(el);\r\n  return {\r\n    top: rect.top - offsetTop + extraOffsetHeight,\r\n    left: rect.left - offsetLeft + extraOffsetWidth,\r\n    bottom: rect.bottom - offsetTop - extraOffsetHeight,\r\n    right: rect.right - offsetLeft - extraOffsetWidth,\r\n    width: width,\r\n    height: height\r\n  };\r\n}\r\n\r\n/**\r\n * Adjust scale from normalized scale (100%) to rendered scale.\r\n *\r\n * @param {SVGElement} svg The SVG to gather metadata from\r\n * @param {Object} rect A map of numeric values to scale\r\n * @return {Object} A copy of `rect` with values scaled up\r\n */\r\nexport function scaleUp(svg, rect) {\r\n  let result = {};\r\n  let { viewport } = getMetadata(svg);\r\n\r\n  Object.keys(rect).forEach((key) => {\r\n    result[key] = rect[key] * viewport.scale;\r\n  });\r\n\r\n  return result;\r\n}\r\n\r\nexport function convertToSvgRect(rect, svg, viewport) {\r\n  let pt1 = [rect.x, rect.y];\r\n  let pt2 = [rect.x + rect.width, rect.y + rect.height];\r\n\r\n  pt1 = convertToSvgPoint(pt1, svg, viewport);\r\n  pt2 = convertToSvgPoint(pt2, svg, viewport);\r\n\r\n  return {\r\n    x: Math.min(pt1[0], pt2[0]),\r\n    y: Math.min(pt1[1], pt2[1]),\r\n    width: Math.abs(pt2[0] - pt1[0]),\r\n    height: Math.abs(pt2[1] - pt1[1])\r\n  };\r\n}\r\n\r\nexport function convertToSvgPoint(pt, svg, viewport) {\r\n  viewport = viewport || getMetadata(svg).viewport;\r\n\r\n  let xform = [ 1, 0, 0, 1, 0, 0 ];\r\n  xform = scale(xform, viewport.scale, viewport.scale);\r\n  xform = rotate(xform, viewport.rotation);\r\n\r\n  let offset = getTranslation(viewport);\r\n  xform = translate(xform, offset.x, offset.y);\r\n\r\n  return applyInverseTransform(pt, xform);\r\n}\r\n\r\nexport function convertToScreenPoint(pt, svg, viewport) {\r\n  viewport = viewport || getMetadata(svg).viewport;\r\n\r\n  let xform = [ 1, 0, 0, 1, 0, 0 ];\r\n  xform = scale(xform, viewport.scale, viewport.scale);\r\n  xform = rotate(xform, viewport.rotation);\r\n\r\n  let offset = getTranslation(viewport);\r\n  xform = translate(xform, offset.x, offset.y);\r\n\r\n  return applyTransform(pt, xform);\r\n}\r\n\r\n/**\r\n * Adjust scale from rendered scale to a normalized scale (100%).\r\n *\r\n * @param {SVGElement} svg The SVG to gather metadata from\r\n * @param {Object} rect A map of numeric values to scale\r\n * @return {Object} A copy of `rect` with values scaled down\r\n */\r\nexport function scaleDown(svg, rect) {\r\n  let result = {};\r\n  let { viewport } = getMetadata(svg);\r\n\r\n  Object.keys(rect).forEach((key) => {\r\n    result[key] = rect[key] / viewport.scale;\r\n  });\r\n\r\n  return result;\r\n}\r\n\r\n/**\r\n * Get the scroll position of an element, accounting for parent elements\r\n *\r\n * @param {Element} el The element to get the scroll position for\r\n * @return {Object} The scrollTop and scrollLeft position\r\n */\r\nexport function getScroll(el) {\r\n  let scrollTop = 0;\r\n  let scrollLeft = 0;\r\n  let parentNode = el;\r\n\r\n  while ((parentNode = parentNode.parentNode) &&\r\n          parentNode !== document) {\r\n    scrollTop += parentNode.scrollTop;\r\n    scrollLeft += parentNode.scrollLeft;\r\n  }\r\n\r\n  return { scrollTop, scrollLeft };\r\n}\r\n\r\n/**\r\n * Get the offset position of an element, accounting for parent elements\r\n *\r\n * @param {Element} el The element to get the offset position for\r\n * @return {Object} The offsetTop and offsetLeft position\r\n */\r\nexport function getOffset(el) {\r\n  let parentNode = el;\r\n\r\n  while ((parentNode = parentNode.parentNode) &&\r\n          parentNode !== document) {\r\n    if (parentNode.nodeName.toUpperCase() === 'SVG') {\r\n      break;\r\n    }\r\n  }\r\n\r\n  let rect = parentNode.getBoundingClientRect();\r\n\r\n  return { offsetLeft: rect.left, offsetTop: rect.top };\r\n}\r\n\r\n/**\r\n * Disable user ability to select text on page\r\n */\r\nexport function disableUserSelect() {\r\n  if (!userSelectStyleSheet.parentNode) {\r\n    document.head.appendChild(userSelectStyleSheet);\r\n  }\r\n}\r\n\r\n/**\r\n * Enable user ability to select text on page\r\n */\r\nexport function enableUserSelect() {\r\n  if (userSelectStyleSheet.parentNode) {\r\n    userSelectStyleSheet.parentNode.removeChild(userSelectStyleSheet);\r\n  }\r\n}\r\n\r\n/**\r\n * Get the metadata for a SVG container\r\n *\r\n * @param {SVGElement} svg The SVG container to get metadata for\r\n */\r\nexport function getMetadata(svg) {\r\n  return {\r\n    documentId: svg.getAttribute('data-pdf-annotate-document'),\r\n    pageNumber: parseInt(svg.getAttribute('data-pdf-annotate-page'), 10),\r\n    viewport: JSON.parse(svg.getAttribute('data-pdf-annotate-viewport'))\r\n  };\r\n}\r\n","import EventEmitter from 'events';\r\nimport {\r\n  findAnnotationAtPoint,\r\n  findSVGAtPoint\r\n} from './utils';\r\n\r\nconst emitter = new EventEmitter();\r\n\r\nlet clickNode;\r\n\r\n/**\r\n * Handle document.click event\r\n *\r\n * @param {Event} e The DOM event to be handled\r\n */\r\ndocument.addEventListener('click', function handleDocumentClick(e) {\r\n  if (!findSVGAtPoint(e.clientX, e.clientY)) {\r\n    return;\r\n  }\r\n\r\n  let target = findAnnotationAtPoint(e.clientX, e.clientY);\r\n\r\n  // Emit annotation:blur if clickNode is no longer clicked\r\n  if (clickNode && clickNode !== target) {\r\n    emitter.emit('annotation:blur', clickNode);\r\n  }\r\n\r\n  // Emit annotation:click if target was clicked\r\n  if (target) {\r\n    emitter.emit('annotation:click', target);\r\n  }\r\n\r\n  clickNode = target;\r\n});\r\n\r\n// let mouseOverNode;\r\n// document.addEventListener('mousemove', function handleDocumentMousemove(e) {\r\n//   let target = findAnnotationAtPoint(e.clientX, e.clientY);\r\n//\r\n//   // Emit annotation:mouseout if target was mouseout'd\r\n//   if (mouseOverNode && !target) {\r\n//     emitter.emit('annotation:mouseout', mouseOverNode);\r\n//   }\r\n//\r\n//   // Emit annotation:mouseover if target was mouseover'd\r\n//   if (target && mouseOverNode !== target) {\r\n//     emitter.emit('annotation:mouseover', target);\r\n//   }\r\n//\r\n//   mouseOverNode = target;\r\n// });\r\n\r\nexport function fireEvent() { emitter.emit(...arguments); };\r\nexport function addEventListener() { emitter.on(...arguments); };\r\nexport function removeEventListener() { emitter.removeListener(...arguments); };\r\n","// Disable JSDoc as it cannot really deal with the odd way that the functions are defined\r\n/* eslint valid-jsdoc: 0 */\r\n\r\nimport abstractFunction from '../utils/abstractFunction';\r\nimport { fireEvent } from '../UI/event';\r\n\r\n// Adapter should never be invoked publicly\r\nexport default class StoreAdapter {\r\n  /**\r\n   * Create a new StoreAdapter instance\r\n   *\r\n   * @param {Object} [definition] The definition to use for overriding abstract methods\r\n   */\r\n  constructor(definition = {}) {\r\n    // Copy each function from definition if it is a function we know about\r\n    Object.keys(definition).forEach((key) => {\r\n      if (typeof definition[key] === 'function' &&\r\n          typeof this[key] === 'function') {\r\n        this[key] = definition[key];\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Get all the annotations for a given document and page number.\r\n   *\r\n   * @param {String} documentId The ID for the document the annotations belong to\r\n   * @param {Number} pageNumber The number of the page the annotations belong to\r\n   * @return {Promise} Promise that returns with list of annotations for document and page\r\n   */\r\n  __getAnnotations(documentId, pageNumber) { abstractFunction('getAnnotations'); }\r\n  get getAnnotations() { return this.__getAnnotations; }\r\n  set getAnnotations(fn) {\r\n    this.__getAnnotations = function getAnnotations(documentId, pageNumber) {\r\n      return fn(...arguments).then((annotations) => {\r\n        // TODO may be best to have this happen on the server\r\n        if (annotations.annotations) {\r\n          annotations.annotations.forEach((a) => {\r\n            a.documentId = documentId;\r\n          });\r\n        }\r\n        return annotations;\r\n      });\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get the definition for a specific annotation.\r\n   *\r\n   * @param {String} documentId The ID for the document the annotation belongs to\r\n   * @param {String} annotationId The ID for the annotation\r\n   * @return {Promise} Promise that returns the requested annotation\r\n   */\r\n  getAnnotation(documentId, annotationId) { abstractFunction('getAnnotation'); }\r\n\r\n  /**\r\n   * Add an annotation\r\n   *\r\n   * @param {String} documentId The ID for the document to add the annotation to\r\n   * @param {String} pageNumber The page number to add the annotation to\r\n   * @param {Object} annotation The definition for the new annotation\r\n   * @return {Promise} Promise that returns with the added annotation\r\n   */\r\n  __addAnnotation(documentId, pageNumber, annotation) { abstractFunction('addAnnotation'); }\r\n  get addAnnotation() { return this.__addAnnotation; }\r\n  set addAnnotation(fn) {\r\n    this.__addAnnotation = function addAnnotation(documentId, pageNumber, annotation) {\r\n      return fn(...arguments).then((annotation) => {\r\n        fireEvent('annotation:add', documentId, pageNumber, annotation);\r\n        return annotation;\r\n      });\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Edit an annotation\r\n   *\r\n   * @param {String} documentId The ID for the document\r\n   * @param {String} pageNumber the page number of the annotation\r\n   * @param {Object} annotation The definition of the modified annotation\r\n   * @return {Promise} Promise that returns with the edited annotation\r\n   */\r\n  __editAnnotation(documentId, pageNumber, annotation) { abstractFunction('editAnnotation'); }\r\n  get editAnnotation() { return this.__editAnnotation; }\r\n  set editAnnotation(fn) {\r\n    this.__editAnnotation = function editAnnotation(documentId, annotationId, annotation) {\r\n      return fn(...arguments).then((annotation) => {\r\n        fireEvent('annotation:edit', documentId, annotationId, annotation);\r\n        return annotation;\r\n      });\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Delete an annotation\r\n   *\r\n   * @param {String} documentId The ID for the document\r\n   * @param {String} annotationId The ID for the annotation\r\n   * @return {Promise} Promise that returns with boolean if annotation was deleted\r\n   */\r\n  __deleteAnnotation(documentId, annotationId) { abstractFunction('deleteAnnotation'); }\r\n  get deleteAnnotation() { return this.__deleteAnnotation; }\r\n  set deleteAnnotation(fn) {\r\n    this.__deleteAnnotation = function deleteAnnotation(documentId, annotationId) {\r\n      return fn(...arguments).then((success) => {\r\n        if (success) {\r\n          fireEvent('annotation:delete', documentId, annotationId);\r\n        }\r\n        return success;\r\n      });\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get all the comments for an annotation\r\n   *\r\n   * @param {String} documentId The ID for the document\r\n   * @param {String} annotationId The ID for the annotation\r\n   * @return {Promise} Promise that returns with comments for annotation\r\n   */\r\n  getComments(documentId, annotationId) { abstractFunction('getComments'); }\r\n\r\n  /**\r\n   * Add a new comment\r\n   *\r\n   * @param {String} documentId The ID for the document\r\n   * @param {String} annotationId The ID for the annotation\r\n   * @param {Object} content The definition of the comment\r\n   * @return {Promise} Promise that returns with the added comment\r\n   */\r\n  __addComment(documentId, annotationId, content) { abstractFunction('addComment'); }\r\n  get addComment() { return this.__addComment; }\r\n  set addComment(fn) {\r\n    this.__addComment = function addComment(documentId, annotationId, content) {\r\n      return fn(...arguments).then((comment) => {\r\n        fireEvent('comment:add', documentId, annotationId, comment);\r\n        return comment;\r\n      });\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Delete a comment\r\n   *\r\n   * @param {String} documentId The ID for the document\r\n   * @param {String} commentId The ID for the comment\r\n   * @return {Promise} Promise that returns with boolean if comment was deleted\r\n   */\r\n  __deleteComment(documentId, commentId) { abstractFunction('deleteComment'); }\r\n  get deleteComment() { return this.__deleteComment; }\r\n  set deleteComment(fn) {\r\n    this.__deleteComment = function deleteComment(documentId, commentId) {\r\n      return fn(...arguments).then((success) => {\r\n        if (success) {\r\n          fireEvent('comment:delete', documentId, commentId);\r\n        }\r\n        return success;\r\n      });\r\n    };\r\n  }\r\n}\r\n","const REGEXP = /[xy]/g;\r\nconst PATTERN = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx';\r\n\r\nfunction replacement(c) {\r\n  let r = Math.random() * 16 | 0;\r\n  let v = c === 'x' ? r : (r & 0x3 | 0x8);\r\n  return v.toString(16);\r\n}\r\n\r\n/**\r\n * Generate a univierally unique identifier\r\n *\r\n * @return {String} A UUID\r\n */\r\nexport default function uuid() {\r\n  return PATTERN.replace(REGEXP, replacement);\r\n}\r\n","import uuid from '../utils/uuid';\r\nimport StoreAdapter from './StoreAdapter';\r\n\r\n// StoreAdapter for working with localStorage\r\n// This is ideal for testing, examples, and prototyping\r\nexport default class LocalStoreAdapter extends StoreAdapter {\r\n  constructor() {\r\n    super({\r\n      getAnnotations(documentId, pageNumber) {\r\n        return new Promise((resolve, reject) => {\r\n          let annotations = getAnnotations(documentId).filter((i) => {\r\n            return i.page === pageNumber && i.class === 'Annotation';\r\n          });\r\n\r\n          resolve({\r\n            documentId,\r\n            pageNumber,\r\n            annotations\r\n          });\r\n        });\r\n      }\r\n    });\r\n\r\n    this.getAnnotation = (documentId, annotationId) => {\r\n      return Promise.resolve(getAnnotations(documentId)[findAnnotation(documentId, annotationId)]);\r\n    };\r\n\r\n    this.addAnnotation = (documentId, pageNumber, annotation) => {\r\n      return new Promise((resolve, reject) => {\r\n        annotation.class = 'Annotation';\r\n        annotation.uuid = uuid();\r\n        annotation.page = pageNumber;\r\n\r\n        let annotations = getAnnotations(documentId);\r\n        annotations.push(annotation);\r\n        updateAnnotations(documentId, annotations);\r\n\r\n        resolve(annotation);\r\n      });\r\n    };\r\n\r\n    this.editAnnotation = (documentId, annotationId, annotation) => {\r\n      return new Promise((resolve, reject) => {\r\n        let annotations = getAnnotations(documentId);\r\n        annotations[findAnnotation(documentId, annotationId)] = annotation;\r\n        updateAnnotations(documentId, annotations);\r\n        resolve(annotation);\r\n      });\r\n    };\r\n\r\n    this.deleteAnnotation = (documentId, annotationId) => {\r\n      return new Promise((resolve, reject) => {\r\n        let annotation = getAnnotations(documentId).filter(i => i.uuid === annotationId)[0] || {};\r\n        if (!annotation) {\r\n          return reject('Could not find annotation');\r\n        }\r\n        let index = findAnnotation(documentId, annotationId);\r\n        if (index > -1) {\r\n          let annotations = getAnnotations(documentId);\r\n          annotations.splice(index, 1);\r\n          updateAnnotations(documentId, annotations);\r\n        }\r\n\r\n        resolve(true);\r\n      });\r\n    };\r\n\r\n    this.getComments = (documentId, annotationId) => {\r\n      return new Promise((resolve, reject) => {\r\n        resolve(getAnnotations(documentId).filter((i) => {\r\n          return i.class === 'Comment' && i.annotation === annotationId;\r\n        }));\r\n      });\r\n    };\r\n\r\n    this.addComment = (documentId, annotationId, content) => {\r\n      return new Promise((resolve, reject) => {\r\n        let comment = {\r\n          class: 'Comment',\r\n          uuid: uuid(),\r\n          annotation: annotationId,\r\n          content: content\r\n        };\r\n\r\n        let annotations = getAnnotations(documentId);\r\n        annotations.push(comment);\r\n        updateAnnotations(documentId, annotations);\r\n\r\n        resolve(comment);\r\n      });\r\n    };\r\n\r\n    this.deleteComment = (documentId, commentId) => {\r\n      return new Promise((resolve, reject) => {\r\n        let comment = getAnnotations(documentId).filter(i => i.uuid === commentId)[0] || {};\r\n        if (!comment) {\r\n          return reject('Could not find annotation');\r\n        }\r\n        let index = -1;\r\n        let annotations = getAnnotations(documentId);\r\n        for (let i = 0, l = annotations.length; i < l; i++) {\r\n          if (annotations[i].uuid === commentId) {\r\n            index = i;\r\n            break;\r\n          }\r\n        }\r\n\r\n        if (index > -1) {\r\n          annotations.splice(index, 1);\r\n          updateAnnotations(documentId, annotations);\r\n        }\r\n\r\n        resolve(true);\r\n      });\r\n    };\r\n  }\r\n}\r\n\r\nfunction getAnnotations(documentId) {\r\n  return JSON.parse(localStorage.getItem(`${documentId}/annotations`)) || [];\r\n}\r\n\r\nfunction updateAnnotations(documentId, annotations) {\r\n  localStorage.setItem(`${documentId}/annotations`, JSON.stringify(annotations));\r\n}\r\n/**\r\n *\r\n * @param {String} documentId Document id of the annotation\r\n * @param {String} annotationId The id of the annotation\r\n *\r\n * This function finds all the annotation made by one user.\r\n *\r\n * @return {int} The index of the annotation in localstorage\r\n */\r\nfunction findAnnotation(documentId, annotationId) {\r\n  let index = -1;\r\n  let annotations = getAnnotations(documentId);\r\n  for (let i = 0, l = annotations.length; i < l; i++) {\r\n    if (annotations[i].uuid === annotationId) {\r\n      index = i;\r\n      break;\r\n    }\r\n  }\r\n  return index;\r\n}\r\n","import uuid from '../utils/uuid';\r\nimport StoreAdapter from './StoreAdapter';\r\n\r\n// StoreAdapter for working with localStorage and associated user id\r\n// This is ideal for testing, examples, and prototyping\r\nexport default class LocalUserStoreAdapter extends StoreAdapter {\r\n  constructor(userId = 'user', globalEdit = false) {\r\n    super({\r\n      getAnnotations(documentId, pageNumber) {\r\n        return new Promise((resolve, reject) => {\r\n          let annotations = getAllAnnotations(documentId).filter((i) => {\r\n            return i.page === pageNumber && i.class === 'Annotation';\r\n          });\r\n\r\n          resolve({\r\n            documentId,\r\n            pageNumber,\r\n            annotations\r\n          });\r\n        });\r\n      }\r\n    });\r\n\r\n    this._userId = userId;\r\n    this._globalEdit = globalEdit;\r\n\r\n    this.getAnnotation = (documentId, annotationId) => {\r\n      return Promise.resolve(getAnnotations(documentId, this._userId)[findAnnotation(documentId, this._userId, annotationId)]);\r\n    };\r\n\r\n    this.addAnnotation = (documentId, pageNumber, annotation) => {\r\n      return new Promise((resolve, reject) => {\r\n        annotation.class = 'Annotation';\r\n        annotation.uuid = uuid();\r\n        annotation.page = pageNumber;\r\n        annotation.userId = this._userId;\r\n\r\n        let annotations = getAnnotations(documentId, this._userId);\r\n        annotations.push(annotation);\r\n        updateAnnotations(documentId, this._userId, annotations);\r\n\r\n        resolve(annotation);\r\n      });\r\n    };\r\n\r\n    this.editAnnotation = (documentId, annotationId, annotation) => {\r\n      return new Promise((resolve, reject) => {\r\n        if (!this._globalEdit && annotation.userId && annotation.userId !== this._userId) {\r\n          reject('Non-matching userId');\r\n        }\r\n        let annotations = getAnnotations(documentId, annotation.userId);\r\n        annotations[findAnnotation(documentId, annotation.userId, annotationId)] = annotation;\r\n        updateAnnotations(documentId, annotation.userId, annotations);\r\n        resolve(annotation);\r\n      });\r\n    };\r\n\r\n    this.deleteAnnotation = (documentId, annotationId) => {\r\n      return new Promise((resolve, reject) => {\r\n        let annotation = getAllAnnotations(documentId).filter(i => i.uuid === annotationId)[0] || {};\r\n        if (!annotation) {\r\n          return reject('Could not find annotation');\r\n        }\r\n        else if (!this._globalEdit && annotation.userId && annotation.userId !== this._userId) {\r\n          return reject('Non-matching userId');\r\n        }\r\n        let index = findAnnotation(documentId, annotation.userId, annotationId);\r\n        if (index > -1) {\r\n          let annotations = getAnnotations(documentId, annotation.userId);\r\n          annotations.splice(index, 1);\r\n          updateAnnotations(documentId, annotation.userId, annotations);\r\n        }\r\n\r\n        resolve(true);\r\n      });\r\n    };\r\n\r\n    this.getComments = (documentId, annotationId) => {\r\n      return new Promise((resolve, reject) => {\r\n        resolve(getAnnotations(documentId, this._userId).filter((i) => {\r\n          return i.class === 'Comment' && i.annotation === annotationId;\r\n        }));\r\n      });\r\n    };\r\n\r\n    this.addComment = (documentId, annotationId, content) => {\r\n      return new Promise((resolve, reject) => {\r\n        let comment = {\r\n          class: 'Comment',\r\n          uuid: uuid(),\r\n          annotation: annotationId,\r\n          content: content,\r\n          userId: this._userId\r\n        };\r\n\r\n        let annotations = getAnnotations(documentId, this._userId);\r\n        annotations.push(comment);\r\n        updateAnnotations(documentId, this._userId, annotations);\r\n\r\n        resolve(comment);\r\n      });\r\n    };\r\n\r\n    this.deleteComment = (documentId, commentId) => {\r\n      return new Promise((resolve, reject) => {\r\n        let comment = getAllAnnotations(documentId).filter(i => i.uuid === commentId)[0] || {};\r\n        if (!comment) {\r\n          return reject('Could not find annotation');\r\n        }\r\n        else if (!this._globalEdit && comment.userId && comment.userId !== this._userId) {\r\n          return reject('Non-matching userId');\r\n        }\r\n        let index = -1;\r\n        let annotations = getAnnotations(documentId, comment.userId);\r\n        for (let i = 0, l = annotations.length; i < l; i++) {\r\n          if (annotations[i].uuid === commentId) {\r\n            index = i;\r\n            break;\r\n          }\r\n        }\r\n\r\n        if (index > -1) {\r\n          annotations.splice(index, 1);\r\n          updateAnnotations(documentId, comment.userId, annotations);\r\n        }\r\n\r\n        resolve(true);\r\n      });\r\n    };\r\n  }\r\n\r\n  get userId() {\r\n    return this._userId;\r\n  }\r\n}\r\n\r\nfunction getAllAnnotations(documentId) {\r\n  let all_annotations = [];\r\n  let re = new RegExp(`${documentId}/(.*)/annotations`);\r\n  for (let i = 0; i < localStorage.length; i++) {\r\n    if (localStorage.key(i).search(re) > -1) {\r\n      all_annotations.push(...JSON.parse(localStorage.getItem(localStorage.key(i))));\r\n    }\r\n  }\r\n  return all_annotations;\r\n}\r\n\r\nfunction getAnnotations(documentId, userId) {\r\n  return JSON.parse(localStorage.getItem(`${documentId}/${userId}/annotations`)) || [];\r\n}\r\n\r\nfunction updateAnnotations(documentId, userId, annotations) {\r\n  localStorage.setItem(`${documentId}/${userId}/annotations`, JSON.stringify(annotations));\r\n}\r\n/**\r\n *\r\n * @param {String} documentId Document id of the annotation\r\n * @param {String} userId User id of the annotation\r\n * @param {String} annotationId The id of the annotation\r\n *\r\n * This function finds all the annotation made by one user.\r\n *\r\n * @return {int} The index of the annotation in localstorage\r\n */\r\nfunction findAnnotation(documentId, userId, annotationId) {\r\n  let index = -1;\r\n  let annotations = getAnnotations(documentId, userId);\r\n  for (let i = 0, l = annotations.length; i < l; i++) {\r\n    if (annotations[i].uuid === annotationId) {\r\n      index = i;\r\n      break;\r\n    }\r\n  }\r\n  return index;\r\n}\r\n","export default {\r\n  annotationLayerName: 'annotationLayer',\r\n  textLayerName: 'textLayer',\r\n  annotationSvgQuery: function() {\r\n    return 'svg.' + this.annotationLayerName;\r\n  },\r\n  annotationClassQuery: function() {\r\n    return '.' + this.annotationLayerName;\r\n  },\r\n  textClassQuery: function() {\r\n    return '.' + this.textLayerName;\r\n  }\r\n};\r\n","import PDFJSAnnotate from '../PDFJSAnnotate';\r\nimport config from '../config';\r\nimport {\r\n  addEventListener,\r\n  removeEventListener\r\n} from './event';\r\nimport {\r\n  BORDER_COLOR,\r\n  disableUserSelect,\r\n  enableUserSelect,\r\n  findSVGContainer,\r\n  findSVGAtPoint,\r\n  getOffsetAnnotationRect,\r\n  getMetadata,\r\n  convertToSvgPoint\r\n} from './utils';\r\n\r\nlet _enabled = false;\r\nlet isDragging = false;\r\nlet overlay;\r\nlet dragOffsetX, dragOffsetY, dragStartX, dragStartY;\r\nconst OVERLAY_BORDER_SIZE = 3;\r\n\r\n/**\r\n * Create an overlay for editing an annotation.\r\n *\r\n * @param {Element} target The annotation element to apply overlay for\r\n */\r\nfunction createEditOverlay(target) {\r\n  destroyEditOverlay();\r\n\r\n  overlay = document.createElement('div');\r\n  let anchor = document.createElement('a');\r\n  let parentNode = findSVGContainer(target).parentNode;\r\n  let id = target.getAttribute('data-pdf-annotate-id');\r\n  let rect = getOffsetAnnotationRect(target);\r\n  let styleLeft = rect.left - OVERLAY_BORDER_SIZE;\r\n  let styleTop = rect.top - OVERLAY_BORDER_SIZE;\r\n\r\n  overlay.setAttribute('id', 'pdf-annotate-edit-overlay');\r\n  overlay.setAttribute('data-target-id', id);\r\n  overlay.style.boxSizing = 'content-box';\r\n  overlay.style.position = 'absolute';\r\n  overlay.style.top = `${styleTop}px`;\r\n  overlay.style.left = `${styleLeft}px`;\r\n  overlay.style.width = `${rect.width}px`;\r\n  overlay.style.height = `${rect.height}px`;\r\n  overlay.style.border = `${OVERLAY_BORDER_SIZE}px solid ${BORDER_COLOR}`;\r\n  overlay.style.borderRadius = `${OVERLAY_BORDER_SIZE}px`;\r\n  overlay.style.zIndex = 20100;\r\n\r\n  anchor.innerHTML = '';\r\n  anchor.setAttribute('href', 'javascript://');\r\n  anchor.style.background = '#fff';\r\n  anchor.style.borderRadius = '20px';\r\n  anchor.style.border = '1px solid #bbb';\r\n  anchor.style.color = '#bbb';\r\n  anchor.style.fontSize = '16px';\r\n  anchor.style.padding = '2px';\r\n  anchor.style.textAlign = 'center';\r\n  anchor.style.textDecoration = 'none';\r\n  anchor.style.position = 'absolute';\r\n  anchor.style.top = '-13px';\r\n  anchor.style.right = '-13px';\r\n  anchor.style.width = '25px';\r\n  anchor.style.height = '25px';\r\n\r\n  overlay.appendChild(anchor);\r\n  parentNode.appendChild(overlay);\r\n  document.addEventListener('click', handleDocumentClick);\r\n  document.addEventListener('keyup', handleDocumentKeyup);\r\n  document.addEventListener('mousedown', handleDocumentMousedown);\r\n  anchor.addEventListener('click', deleteAnnotation);\r\n  anchor.addEventListener('mouseover', () => {\r\n    anchor.style.color = '#35A4DC';\r\n    anchor.style.borderColor = '#999';\r\n    anchor.style.boxShadow = '0 1px 1px #ccc';\r\n  });\r\n  anchor.addEventListener('mouseout', () => {\r\n    anchor.style.color = '#bbb';\r\n    anchor.style.borderColor = '#bbb';\r\n    anchor.style.boxShadow = '';\r\n  });\r\n  overlay.addEventListener('mouseover', () => {\r\n    if (!isDragging) { anchor.style.display = ''; }\r\n  });\r\n  overlay.addEventListener('mouseout', () => {\r\n    anchor.style.display = 'none';\r\n  });\r\n}\r\n\r\n/**\r\n * Destroy the edit overlay if it exists.\r\n */\r\nfunction destroyEditOverlay() {\r\n  if (overlay) {\r\n    overlay.parentNode.removeChild(overlay);\r\n    overlay = null;\r\n  }\r\n\r\n  document.removeEventListener('click', handleDocumentClick);\r\n  document.removeEventListener('keyup', handleDocumentKeyup);\r\n  document.removeEventListener('mousedown', handleDocumentMousedown);\r\n  document.removeEventListener('mousemove', handleDocumentMousemove);\r\n  document.removeEventListener('mouseup', handleDocumentMouseup);\r\n  enableUserSelect();\r\n}\r\n\r\n/**\r\n * Delete currently selected annotation\r\n */\r\nfunction deleteAnnotation() {\r\n  if (!overlay) {\r\n    return;\r\n  }\r\n\r\n  let annotationId = overlay.getAttribute('data-target-id');\r\n  let svg = overlay.parentNode.querySelector(config.annotationSvgQuery());\r\n  let { documentId } = getMetadata(svg);\r\n\r\n  PDFJSAnnotate.getStoreAdapter().deleteAnnotation(documentId, annotationId).then(() => {\r\n    let nodes = document.querySelectorAll(`[data-pdf-annotate-id=\"${annotationId}\"]`);\r\n\r\n    [...nodes].forEach((n) => {\r\n      n.parentNode.removeChild(n);\r\n    });\r\n  });\r\n\r\n  destroyEditOverlay();\r\n}\r\n\r\n/**\r\n * Handle document.click event\r\n *\r\n * @param {Event} e The DOM event that needs to be handled\r\n */\r\nfunction handleDocumentClick(e) {\r\n  if (!findSVGAtPoint(e.clientX, e.clientY)) { return; }\r\n\r\n  // Remove current overlay\r\n  let overlay = document.getElementById('pdf-annotate-edit-overlay');\r\n  if (overlay) {\r\n    if (isDragging || e.target === overlay) {\r\n      return;\r\n    }\r\n\r\n    destroyEditOverlay();\r\n  }\r\n}\r\n\r\n/**\r\n * Handle document.keyup event\r\n *\r\n * @param {KeyboardEvent} e The DOM event that needs to be handled\r\n */\r\nfunction handleDocumentKeyup(e) {\r\n  // keyCode is deprecated, so prefer the newer \"key\" method if possible\r\n  let keyTest;\r\n  if (e.key) {\r\n    keyTest = e.key.toLowerCase() === 'delete' || e.key.toLowerCase() === 'backspace';\r\n  }\r\n  else {\r\n    keyTest = e.keyCode === 8 || e.keyCode === 46;\r\n  }\r\n  if (overlay && keyTest &&\r\n      e.target.nodeName.toLowerCase() !== 'textarea' &&\r\n      e.target.nodeName.toLowerCase() !== 'input') {\r\n    e.preventDefault();\r\n    deleteAnnotation();\r\n  }\r\n}\r\n\r\n/**\r\n * Handle document.mousedown event\r\n *\r\n * @param {Event} e The DOM event that needs to be handled\r\n */\r\nfunction handleDocumentMousedown(e) {\r\n  if (e.target !== overlay) {\r\n    return;\r\n  }\r\n\r\n  // Highlight and strikeout annotations are bound to text within the document.\r\n  // It doesn't make sense to allow repositioning these types of annotations.\r\n  let annotationId = overlay.getAttribute('data-target-id');\r\n  let target = document.querySelector(`[data-pdf-annotate-id=\"${annotationId}\"]`);\r\n  let type = target.getAttribute('data-pdf-annotate-type');\r\n\r\n  if (type === 'highlight' || type === 'strikeout') { return; }\r\n\r\n  isDragging = true;\r\n  dragOffsetX = e.clientX;\r\n  dragOffsetY = e.clientY;\r\n  dragStartX = overlay.offsetLeft;\r\n  dragStartY = overlay.offsetTop;\r\n\r\n  overlay.style.background = 'rgba(255, 255, 255, 0.7)';\r\n  overlay.style.cursor = 'move';\r\n  overlay.querySelector('a').style.display = 'none';\r\n\r\n  document.addEventListener('mousemove', handleDocumentMousemove);\r\n  document.addEventListener('mouseup', handleDocumentMouseup);\r\n  disableUserSelect();\r\n}\r\n\r\n/**\r\n * Handle document.mousemove event\r\n *\r\n * @param {Event} e The DOM event that needs to be handled\r\n */\r\nfunction handleDocumentMousemove(e) {\r\n  let parentNode = overlay.parentNode;\r\n  let rect = parentNode.getBoundingClientRect();\r\n  let y = (dragStartY + (e.clientY - dragOffsetY));\r\n  let x = (dragStartX + (e.clientX - dragOffsetX));\r\n  let minY = 0;\r\n  let maxY = rect.height;\r\n  let minX = 0;\r\n  let maxX = rect.width;\r\n\r\n  if (y > minY && y + overlay.offsetHeight < maxY) {\r\n    overlay.style.top = `${y}px`;\r\n  }\r\n\r\n  if (x > minX && x + overlay.offsetWidth < maxX) {\r\n    overlay.style.left = `${x}px`;\r\n  }\r\n}\r\n\r\n/**\r\n * Handle document.mouseup event\r\n *\r\n * @param {Event} e The DOM event that needs to be handled\r\n */\r\nfunction handleDocumentMouseup(e) {\r\n  let annotationId = overlay.getAttribute('data-target-id');\r\n  let target = document.querySelectorAll(`[data-pdf-annotate-id=\"${annotationId}\"]`);\r\n  let type = target[0].getAttribute('data-pdf-annotate-type');\r\n  let svg = overlay.parentNode.querySelector(config.annotationSvgQuery());\r\n  let { documentId } = getMetadata(svg);\r\n\r\n  overlay.querySelector('a').style.display = '';\r\n\r\n  PDFJSAnnotate.getStoreAdapter().getAnnotation(documentId, annotationId).then((annotation) => {\r\n    let attribX = 'x';\r\n    let attribY = 'y';\r\n    if (['circle', 'fillcircle', 'emptycircle'].indexOf(type) > -1) {\r\n      attribX = 'cx';\r\n      attribY = 'cy';\r\n    }\r\n\r\n    if (type === 'point') {\r\n      // Broken\r\n      /*\r\n      [...target].forEach((t, i) => {\r\n        let moveTo = {\r\n          x: overlay.offsetLeft + 3,\r\n          y: overlay.offsetTop + 3\r\n        };\r\n        t.setAttribute(attribX, moveTo.x);\r\n        t.setAttribute(attribY, moveTo.y);\r\n        annotation[attribX] = moveTo.x;\r\n        annotation[attribY] = moveTo.y;\r\n      });\r\n      */\r\n      return;\r\n    }\r\n    else if (['area', 'highlight', 'textbox', 'circle', 'fillcircle', 'emptycircle'].indexOf(type) > -1) {\r\n      let modelStart = convertToSvgPoint([dragStartX, dragStartY], svg);\r\n      let modelEnd = convertToSvgPoint([overlay.offsetLeft, overlay.offsetTop], svg);\r\n      let modelDelta = {\r\n        x: modelEnd[0] - modelStart[0],\r\n        y: modelEnd[1] - modelStart[1]\r\n      };\r\n\r\n      if (type === 'textbox') {\r\n        target = [target[0].firstChild];\r\n      }\r\n\r\n      [...target].forEach((t, i) => {\r\n        let modelX = parseInt(t.getAttribute(attribX), 10);\r\n        let modelY = parseInt(t.getAttribute(attribY), 10);\r\n        if (modelDelta.y !== 0) {\r\n          modelY = modelY + modelDelta.y;\r\n\r\n          t.setAttribute(attribY, modelY);\r\n          if (annotation.rectangles && i < annotation.rectangles.length) {\r\n            annotation.rectangles[i].y = modelY;\r\n          }\r\n          else if (annotation[attribY]) {\r\n            annotation[attribY] = modelY;\r\n          }\r\n        }\r\n        if (modelDelta.x !== 0) {\r\n          modelX = modelX + modelDelta.x;\r\n\r\n          t.setAttribute(attribX, modelX);\r\n          if (annotation.rectangles && i < annotation.rectangles.length) {\r\n            annotation.rectangles[i].x = modelX;\r\n          }\r\n          else if (annotation[attribX]) {\r\n            annotation[attribX] = modelX;\r\n          }\r\n        }\r\n      });\r\n    }\r\n    else if (type === 'strikeout') {\r\n      return;\r\n    //   let { deltaX, deltaY } = getDelta('x1', 'y1');\r\n    //   [...target].forEach(target, (t, i) => {\r\n    //     if (deltaY !== 0) {\r\n    //       t.setAttribute('y1', parseInt(t.getAttribute('y1'), 10) + deltaY);\r\n    //       t.setAttribute('y2', parseInt(t.getAttribute('y2'), 10) + deltaY);\r\n    //       annotation.rectangles[i].y = parseInt(t.getAttribute('y1'), 10);\r\n    //     }\r\n    //     if (deltaX !== 0) {\r\n    //       t.setAttribute('x1', parseInt(t.getAttribute('x1'), 10) + deltaX);\r\n    //       t.setAttribute('x2', parseInt(t.getAttribute('x2'), 10) + deltaX);\r\n    //       annotation.rectangles[i].x = parseInt(t.getAttribute('x1'), 10);\r\n    //     }\r\n    //   });\r\n    }\r\n    else if (type === 'drawing' || type === 'arrow') {\r\n      // Do nothing as currently broken\r\n      /*\r\n      let modelStart = convertToSvgPoint([dragStartX, dragStartY], svg);\r\n      let modelEnd = convertToSvgPoint([overlay.offsetLeft, overlay.offsetTop], svg);\r\n      let modelDelta = {\r\n        x: modelEnd[0] - modelStart[0],\r\n        y: modelEnd[1] - modelStart[1]\r\n      };\r\n\r\n      annotation.lines.forEach((line, i) => {\r\n        let [x, y] = annotation.lines[i];\r\n        annotation.lines[i][0] = x + modelDelta.x;\r\n        annotation.lines[i][1] = y + modelDelta.y;\r\n      });\r\n\r\n      target[0].parentNode.removeChild(target[0]);\r\n      appendChild(svg, annotation);\r\n      */\r\n      return;\r\n    }\r\n\r\n    PDFJSAnnotate.getStoreAdapter().editAnnotation(documentId, annotationId, annotation);\r\n  });\r\n\r\n  setTimeout(() => {\r\n    isDragging = false;\r\n  }, 0);\r\n\r\n  overlay.style.background = '';\r\n  overlay.style.cursor = '';\r\n\r\n  document.removeEventListener('mousemove', handleDocumentMousemove);\r\n  document.removeEventListener('mouseup', handleDocumentMouseup);\r\n  enableUserSelect();\r\n}\r\n\r\n/**\r\n * Handle annotation.click event\r\n *\r\n * @param {Element} e The annotation element that was clicked\r\n */\r\nfunction handleAnnotationClick(target) {\r\n  createEditOverlay(target);\r\n}\r\n\r\n/**\r\n * Enable edit mode behavior.\r\n */\r\nexport function enableEdit() {\r\n  if (_enabled) {\r\n    return;\r\n  }\r\n\r\n  _enabled = true;\r\n  addEventListener('annotation:click', handleAnnotationClick);\r\n};\r\n\r\n/**\r\n * Disable edit mode behavior.\r\n */\r\nexport function disableEdit() {\r\n  destroyEditOverlay();\r\n\r\n  if (!_enabled) {\r\n    return;\r\n  }\r\n\r\n  _enabled = false;\r\n  removeEventListener('annotation:click', handleAnnotationClick);\r\n};\r\n\r\n","import PDFJSAnnotate from '../PDFJSAnnotate';\r\nimport { appendChild } from '../render/appendChild';\r\nimport {\r\n  disableUserSelect,\r\n  enableUserSelect,\r\n  findSVGAtPoint,\r\n  getMetadata,\r\n  convertToSvgPoint\r\n} from './utils';\r\n\r\nlet _enabled = false;\r\nlet _candraw = false;\r\nlet _penSize;\r\nlet _penColor;\r\nlet path;\r\nlet lines = [];\r\n\r\n/**\r\n * Handle document.touchdown or document.pointerdown event\r\n * @param {PointerEvent} e The DOM event to be handled\r\n */\r\nfunction handleDocumentPointerdown(e) {\r\n  path = null;\r\n  lines = [];\r\n  if (!findSVGAtPoint(e.clientX, e.clientY)) {\r\n    return;\r\n  }\r\n  _candraw = true;\r\n  e.preventDefault();\r\n}\r\n\r\n/**\r\n * Handle document.pointerup event\r\n *\r\n * @param {PointerEvent} e The DOM event to be handled\r\n */\r\nfunction handleDocumentPointerup(e) {\r\n  saveToStorage(e.clientX, e.clientY);\r\n}\r\n\r\nfunction saveToStorage(x, y) {\r\n  if (!_candraw) {\r\n    return;\r\n  }\r\n  _candraw = false;\r\n  let svg;\r\n  if (lines.length > 1 && (svg = findSVGAtPoint(x, y))) {\r\n    let { documentId, pageNumber } = getMetadata(svg);\r\n    PDFJSAnnotate.getStoreAdapter().addAnnotation(documentId, pageNumber, {\r\n      type: 'drawing',\r\n      width: _penSize,\r\n      color: _penColor,\r\n      lines\r\n    }).then((annotation) => {\r\n      if (path) {\r\n        svg.removeChild(path);\r\n      }\r\n\r\n      appendChild(svg, annotation);\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Handle document.mousemove event\r\n *\r\n * @param {PointerEvent} e The DOM event to be handled\r\n */\r\nfunction handleDocumentPointermove(e) {\r\n  if (!findSVGAtPoint(e.clientX, e.clientY) || !_candraw) {\r\n    return;\r\n  }\r\n  savePoint(e.clientX, e.clientY);\r\n}\r\n\r\n/**\r\n * Handle document.keyup event\r\n *\r\n * @param {KeyboardEvent} e The DOM event to be handled\r\n * } e The DOM event to be handled\r\n */\r\nfunction handleDocumentKeyup(e) {\r\n  // Cancel rect if Esc is pressed\r\n  if (e.keyCode === 27) {\r\n    lines = null;\r\n    path.parentNode.removeChild(path);\r\n    document.removeEventListener('pointermove', handleDocumentPointermove);\r\n    document.removeEventListener('pointerup', handleDocumentPointerup);\r\n  }\r\n}\r\n\r\n/**\r\n * Save a point to the line being drawn.\r\n *\r\n * @param {Number} x The x coordinate of the point\r\n * @param {Number} y The y coordinate of the point\r\n */\r\nfunction savePoint(x, y) {\r\n  let svg = findSVGAtPoint(x, y);\r\n  if (!svg) {\r\n    return;\r\n  }\r\n\r\n  let rect = svg.getBoundingClientRect();\r\n  let point = convertToSvgPoint([\r\n    x - rect.left,\r\n    y - rect.top\r\n  ], svg);\r\n  point[0] = point[0].toFixed(2);\r\n  point[1] = point[1].toFixed(2);\r\n  lines.push(point);\r\n\r\n  if (lines.length <= 1) {\r\n    return;\r\n  }\r\n\r\n  if (path) {\r\n    svg.removeChild(path);\r\n  }\r\n\r\n  path = appendChild(svg, {\r\n    type: 'drawing',\r\n    color: _penColor,\r\n    width: _penSize,\r\n    lines\r\n  });\r\n}\r\n\r\n/**\r\n * Set the attributes of the pen.\r\n *\r\n * @param {Number} penSize The size of the lines drawn by the pen, rounded to 2 decimal places\r\n * @param {String} penColor The color of the lines drawn by the pen\r\n */\r\nexport function setPen(penSize = 1, penColor = '000000') {\r\n  _penSize = Math.round(parseFloat(penSize) * 1e2) / 1e2;\r\n  _penColor = penColor;\r\n}\r\n\r\n/**\r\n * Return pen attributes of the pen\r\n *\r\n * @return {Object} Object with size and color\r\n */\r\nexport function getPen() {\r\n  return {\r\n    size: _penSize,\r\n    color: _penColor\r\n  };\r\n}\r\n\r\n/**\r\n * Enable the pen behavior\r\n */\r\nexport function enablePen() {\r\n  if (_enabled) {\r\n    return;\r\n  }\r\n\r\n  _enabled = true;\r\n  // Chrome and Firefox has different behaviors with how pen works, so we need different events.\r\n  document.addEventListener('pointerdown', handleDocumentPointerdown);\r\n  document.addEventListener('pointermove', handleDocumentPointermove);\r\n  document.addEventListener('pointerup', handleDocumentPointerup);\r\n\r\n  document.addEventListener('keyup', handleDocumentKeyup);\r\n  disableUserSelect();\r\n}\r\n\r\n/**\r\n * Disable the pen behavior\r\n */\r\nexport function disablePen() {\r\n  if (!_enabled) {\r\n    return;\r\n  }\r\n\r\n  _enabled = false;\r\n  document.removeEventListener('pointerdown', handleDocumentPointerdown);\r\n  document.removeEventListener('pointermove', handleDocumentPointermove);\r\n  document.removeEventListener('pointerup', handleDocumentPointerup);\r\n\r\n  document.removeEventListener('keyup', handleDocumentKeyup);\r\n  enableUserSelect();\r\n}\r\n","import PDFJSAnnotate from '../PDFJSAnnotate';\r\nimport { appendChild } from '../render/appendChild';\r\nimport {\r\n  disableUserSelect,\r\n  enableUserSelect,\r\n  findSVGAtPoint,\r\n  findSVGContainer,\r\n  getMetadata,\r\n  convertToSvgPoint,\r\n  convertToScreenPoint,\r\n  findAnnotationAtPoint\r\n} from './utils';\r\n\r\nlet _enabled = false;\r\nlet _penSize;\r\nlet _penColor;\r\nlet path;\r\nlet lines;\r\nlet originY;\r\nlet originX;\r\n\r\n/**\r\n * Handle document.mousedown event\r\n */\r\nfunction handleDocumentMousedown(e) {\r\n  let target = findAnnotationAtPoint(e.clientX, e.clientY);\r\n  if (target === null) {\r\n    return;\r\n  }\r\n\r\n  let type = target.getAttribute('data-pdf-annotate-type');\r\n  if (type !== 'circle' && type !== 'fillcircle' && type !== 'emptycircle') {\r\n    return;\r\n  }\r\n\r\n  let svg = findSVGContainer(target);\r\n  let { documentId } = getMetadata(svg);\r\n  let annotationId = target.getAttribute('data-pdf-annotate-id');\r\n\r\n  PDFJSAnnotate.getStoreAdapter().getAnnotation(documentId, annotationId).then((annotation) => {\r\n    if (annotation) {\r\n      path = null;\r\n      lines = [];\r\n\r\n      let point = convertToScreenPoint([\r\n        annotation.cx,\r\n        annotation.cy\r\n      ], svg);\r\n\r\n      let rect = svg.getBoundingClientRect();\r\n\r\n      originX = point[0] + rect.left;\r\n      originY = point[1] + rect.top;\r\n\r\n      document.addEventListener('mousemove', handleDocumentMousemove);\r\n      document.addEventListener('mouseup', handleDocumentMouseup);\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Handle document.mouseup event\r\n *\r\n * @param {Event} e The DOM event to be handled\r\n */\r\nfunction handleDocumentMouseup(e) {\r\n  let svg;\r\n  if (lines.length > 1 && (svg = findSVGAtPoint(e.clientX, e.clientY))) {\r\n    let { documentId, pageNumber } = getMetadata(svg);\r\n\r\n    PDFJSAnnotate.getStoreAdapter().addAnnotation(documentId, pageNumber, {\r\n      type: 'arrow',\r\n      width: _penSize,\r\n      color: _penColor,\r\n      lines\r\n    }).then((annotation) => {\r\n      if (path) {\r\n        svg.removeChild(path);\r\n      }\r\n\r\n      appendChild(svg, annotation);\r\n    });\r\n  }\r\n\r\n  document.removeEventListener('mousemove', handleDocumentMousemove);\r\n  document.removeEventListener('mouseup', handleDocumentMouseup);\r\n}\r\n\r\n/**\r\n * Handle document.mousemove event\r\n *\r\n * @param {Event} e The DOM event to be handled\r\n */\r\nfunction handleDocumentMousemove(e) {\r\n  let x = lines.length === 0 ? originX : e.clientX;\r\n  let y = lines.length === 0 ? originY : e.clientY;\r\n\r\n  savePoint(x, y);\r\n}\r\n\r\n/**\r\n * Handle document.keyup event\r\n *\r\n * @param {Event} e The DOM event to be handled\r\n */\r\nfunction handleDocumentKeyup(e) {\r\n  // Cancel rect if Esc is pressed\r\n  if (e.keyCode === 27) {\r\n    lines = null;\r\n    path.parentNode.removeChild(path);\r\n    document.removeEventListener('mousemove', handleDocumentMousemove);\r\n    document.removeEventListener('mouseup', handleDocumentMouseup);\r\n  }\r\n}\r\n\r\n/**\r\n * Save a point to the line being drawn.\r\n *\r\n * @param {Number} x The x coordinate of the point\r\n * @param {Number} y The y coordinate of the point\r\n */\r\nfunction savePoint(x, y) {\r\n  let svg = findSVGAtPoint(x, y);\r\n  if (!svg) {\r\n    return;\r\n  }\r\n\r\n  let rect = svg.getBoundingClientRect();\r\n  let point = convertToSvgPoint([\r\n    x - rect.left,\r\n    y - rect.top\r\n  ], svg);\r\n\r\n  if (lines.length < 2) {\r\n    lines.push(point);\r\n    return;\r\n  }\r\n  else {\r\n    lines[1] = point; // update end point\r\n  }\r\n\r\n  if (path) {\r\n    svg.removeChild(path);\r\n  }\r\n\r\n  path = appendChild(svg, {\r\n    type: 'arrow',\r\n    color: _penColor,\r\n    width: _penSize,\r\n    lines\r\n  });\r\n}\r\n\r\n/**\r\n * Set the attributes of the pen.\r\n *\r\n * @param {Number} penSize The size of the lines drawn by the pen\r\n * @param {String} penColor The color of the lines drawn by the pen\r\n */\r\nexport function setArrow(penSize = 10, penColor = '0000FF') {\r\n  _penSize = parseInt(penSize, 10);\r\n  _penColor = penColor;\r\n}\r\n\r\n/**\r\n * Enable the pen behavior\r\n */\r\nexport function enableArrow() {\r\n  if (_enabled) { return; }\r\n\r\n  _enabled = true;\r\n  document.addEventListener('mousedown', handleDocumentMousedown);\r\n  document.addEventListener('keyup', handleDocumentKeyup);\r\n  disableUserSelect();\r\n}\r\n\r\n/**\r\n * Disable the pen behavior\r\n */\r\nexport function disableArrow() {\r\n  if (!_enabled) { return; }\r\n\r\n  _enabled = false;\r\n  document.removeEventListener('mousedown', handleDocumentMousedown);\r\n  document.removeEventListener('keyup', handleDocumentKeyup);\r\n  enableUserSelect();\r\n}\r\n\r\n","import PDFJSAnnotate from '../PDFJSAnnotate';\r\nimport {\r\n  findAnnotationAtPoint,\r\n  getMetadata\r\n} from './utils';\r\n\r\nlet _canerase = false;\r\nlet previousPoint = null;\r\n\r\n/**\r\n *\r\n * @param {PointerEvent} e DOM event to handle\r\n */\r\nfunction handleDocumentDown(e) {\r\n  _canerase = true;\r\n  previousPoint = [e.clientX, e.clientY];\r\n}\r\n\r\n/**\r\n *\r\n * @param {PointerEvent} e DOM event to handle\r\n */\r\nfunction handleDocumentUp(e) {\r\n  _canerase = false;\r\n  erase(findAnnotationAtPoint(e.clientX, e.clientY));\r\n}\r\n\r\n/**\r\n *\r\n * @param {PointerEvent} e DOM event to handle\r\n */\r\nfunction handleDocumentMouseMove(e) {\r\n  if (!_canerase) {\r\n    return;\r\n  }\r\n\r\n  // This algorithm attempts to get the various points between the last\r\n  // PointerEvent and this one\r\n  let check = [];\r\n  let diffX = Math.abs(previousPoint[0] - e.clientX);\r\n  let diffY = Math.abs(previousPoint[1] - e.clientY);\r\n  if (diffX >= 1 || diffY >= 1) {\r\n    let maxSteps = Math.round(Math.max(diffX, diffY));\r\n    let subStepSize = Math.min(diffX, diffY) / maxSteps;\r\n    let smallerTest = diffX < diffY;\r\n    let startPoint = [\r\n      Math.min(previousPoint[0], e.clientX),\r\n      Math.min(previousPoint[1], e.clientY)\r\n    ];\r\n    for (let i = 0; i < maxSteps; i++) {\r\n      if (smallerTest) {\r\n        check.push([Math.round(startPoint[0] + (subStepSize * i)), Math.round(startPoint[1] + i)]);\r\n      }\r\n      else {\r\n        check.push([Math.round(startPoint[0] + i), Math.round(startPoint[1] + (subStepSize * i))]);\r\n      }\r\n    }\r\n  }\r\n  for (let point of check) {\r\n    erase(findAnnotationAtPoint(point[0], point[1]));\r\n  }\r\n  previousPoint = [e.clientX, e.clientY];\r\n}\r\n\r\nfunction erase(target) {\r\n  if (!_canerase) {\r\n    return;\r\n  }\r\n\r\n  if (target) {\r\n    let { documentId } = getMetadata(target.parentElement);\r\n    let annotationId = target.getAttribute('data-pdf-annotate-id');\r\n    PDFJSAnnotate.getStoreAdapter().deleteAnnotation(documentId, annotationId).then(() => {\r\n      let nodes = document.querySelectorAll(`[data-pdf-annotate-id=\"${annotationId}\"]`);\r\n      [...nodes].forEach((n) => {\r\n        n.parentNode.removeChild(n);\r\n      });\r\n    });\r\n  }\r\n}\r\n\r\nexport function enableEraser() {\r\n  document.addEventListener('pointermove', handleDocumentMouseMove);\r\n  document.addEventListener('pointerdown', handleDocumentDown);\r\n  document.addEventListener('pointerup', handleDocumentUp);\r\n}\r\n\r\nexport function disableEraser() {\r\n  document.removeEventListener('pointermove', handleDocumentMouseMove);\r\n  document.removeEventListener('pointerdown', handleDocumentDown);\r\n  document.removeEventListener('pointerup', handleDocumentUp);\r\n}\r\n","import PDFJSAnnotate from '../PDFJSAnnotate';\r\nimport { appendChild } from '../render/appendChild';\r\nimport {\r\n  BORDER_COLOR,\r\n  findSVGAtPoint,\r\n  getMetadata,\r\n  scaleDown\r\n} from './utils';\r\n\r\nlet _enabled = false;\r\nlet input;\r\n\r\n/**\r\n * Handle document.mouseup event\r\n *\r\n * @param {Event} The DOM event to be handled\r\n */\r\nfunction handleDocumentMouseup(e) {\r\n  if (input || !findSVGAtPoint(e.clientX, e.clientY)) {\r\n    return;\r\n  }\r\n\r\n  input = document.createElement('input');\r\n  input.setAttribute('id', 'pdf-annotate-point-input');\r\n  input.setAttribute('placeholder', 'Enter comment');\r\n  input.style.border = `3px solid ${BORDER_COLOR}`;\r\n  input.style.borderRadius = '3px';\r\n  input.style.position = 'absolute';\r\n  input.style.top = `${e.clientY}px`;\r\n  input.style.left = `${e.clientX}px`;\r\n\r\n  input.addEventListener('blur', handleInputBlur);\r\n  input.addEventListener('keyup', handleInputKeyup);\r\n\r\n  document.body.appendChild(input);\r\n  input.focus();\r\n}\r\n\r\n/**\r\n * Handle input.blur event\r\n */\r\nfunction handleInputBlur() {\r\n  savePoint();\r\n}\r\n\r\n/**\r\n * Handle input.keyup event\r\n *\r\n * @param {Event} e The DOM event to handle\r\n */\r\nfunction handleInputKeyup(e) {\r\n  if (e.keyCode === 27) {\r\n    closeInput();\r\n  }\r\n  else if (e.keyCode === 13) {\r\n    savePoint();\r\n  }\r\n}\r\n\r\n/**\r\n * Save a new point annotation from input\r\n */\r\nfunction savePoint() {\r\n  if (input.value.trim().length > 0) {\r\n    let clientX = parseInt(input.style.left, 10);\r\n    let clientY = parseInt(input.style.top, 10);\r\n    let content = input.value.trim();\r\n    let svg = findSVGAtPoint(clientX, clientY);\r\n    if (!svg) {\r\n      return;\r\n    }\r\n\r\n    let rect = svg.getBoundingClientRect();\r\n    let { documentId, pageNumber } = getMetadata(svg);\r\n    let annotation = Object.assign({\r\n      type: 'point'\r\n    }, scaleDown(svg, {\r\n      x: clientX - rect.left,\r\n      y: clientY - rect.top\r\n    }));\r\n\r\n    PDFJSAnnotate.getStoreAdapter().addAnnotation(documentId, pageNumber, annotation)\r\n      .then((annotation) => {\r\n        PDFJSAnnotate.getStoreAdapter().addComment(\r\n          documentId,\r\n          annotation.uuid,\r\n          content\r\n        );\r\n\r\n        appendChild(svg, annotation);\r\n      });\r\n  }\r\n\r\n  closeInput();\r\n}\r\n\r\n/**\r\n * Close the input element\r\n */\r\nfunction closeInput() {\r\n  input.removeEventListener('blur', handleInputBlur);\r\n  input.removeEventListener('keyup', handleInputKeyup);\r\n  document.body.removeChild(input);\r\n  input = null;\r\n}\r\n\r\n/**\r\n * Enable point annotation behavior\r\n */\r\nexport function enablePoint() {\r\n  if (_enabled) { return; }\r\n\r\n  _enabled = true;\r\n  document.addEventListener('mouseup', handleDocumentMouseup);\r\n}\r\n\r\n/**\r\n * Disable point annotation behavior\r\n */\r\nexport function disablePoint() {\r\n  if (!_enabled) { return; }\r\n\r\n  _enabled = false;\r\n  document.removeEventListener('mouseup', handleDocumentMouseup);\r\n}\r\n\r\n","import PDFJSAnnotate from '../PDFJSAnnotate';\r\nimport config from '../config';\r\nimport { appendChild } from '../render/appendChild';\r\nimport {\r\n  BORDER_COLOR,\r\n  disableUserSelect,\r\n  enableUserSelect,\r\n  findSVGAtPoint,\r\n  getMetadata,\r\n  convertToSvgRect\r\n} from './utils';\r\n\r\nlet _enabled = false;\r\nlet _type;\r\nlet overlay;\r\nlet originY;\r\nlet originX;\r\n\r\n/**\r\n * Get the current window selection as rects\r\n *\r\n * @return {Array} An Array of rects\r\n */\r\nfunction getSelectionRects() {\r\n  try {\r\n    let selection = window.getSelection();\r\n    let range = selection.getRangeAt(0);\r\n    let rects = range.getClientRects();\r\n\r\n    if (rects.length > 0 &&\r\n        rects[0].width > 0 &&\r\n        rects[0].height > 0) {\r\n      return rects;\r\n    }\r\n  }\r\n  catch (e) {}\r\n\r\n  return null;\r\n}\r\n\r\n/**\r\n * Handle document.mousedown event\r\n *\r\n * @param {Event} e The DOM event to handle\r\n */\r\nfunction handleDocumentMousedown(e) {\r\n  let svg;\r\n  if (_type !== 'area' || !(svg = findSVGAtPoint(e.clientX, e.clientY))) {\r\n    return;\r\n  }\r\n\r\n  let rect = svg.getBoundingClientRect();\r\n  originY = e.clientY;\r\n  originX = e.clientX;\r\n\r\n  overlay = document.createElement('div');\r\n  overlay.style.position = 'absolute';\r\n  overlay.style.top = `${originY - rect.top}px`;\r\n  overlay.style.left = `${originX - rect.left}px`;\r\n  overlay.style.border = `3px solid ${BORDER_COLOR}`;\r\n  overlay.style.borderRadius = '3px';\r\n  svg.parentNode.appendChild(overlay);\r\n\r\n  document.addEventListener('mousemove', handleDocumentMousemove);\r\n  disableUserSelect();\r\n}\r\n\r\n/**\r\n * Handle document.mousemove event\r\n *\r\n * @param {Event} e The DOM event to handle\r\n */\r\nfunction handleDocumentMousemove(e) {\r\n  let svg = overlay.parentNode.querySelector(config.annotationSvgQuery());\r\n  let rect = svg.getBoundingClientRect();\r\n\r\n  if (originX + (e.clientX - originX) < rect.right) {\r\n    overlay.style.width = `${e.clientX - originX}px`;\r\n  }\r\n\r\n  if (originY + (e.clientY - originY) < rect.bottom) {\r\n    overlay.style.height = `${e.clientY - originY}px`;\r\n  }\r\n}\r\n\r\n/**\r\n * Handle document.mouseup event\r\n *\r\n * @param {Event} e The DOM event to handle\r\n */\r\nfunction handleDocumentMouseup(e) {\r\n  let rects;\r\n  if (_type !== 'area' && (rects = getSelectionRects())) {\r\n    saveRect(_type, [...rects].map((r) => {\r\n      return {\r\n        top: r.top,\r\n        left: r.left,\r\n        width: r.width,\r\n        height: r.height\r\n      };\r\n    }));\r\n  }\r\n  else if (_type === 'area' && overlay) {\r\n    let svg = overlay.parentNode.querySelector(config.annotationSvgQuery());\r\n    let rect = svg.getBoundingClientRect();\r\n    saveRect(_type, [{\r\n      top: parseInt(overlay.style.top, 10) + rect.top,\r\n      left: parseInt(overlay.style.left, 10) + rect.left,\r\n      width: parseInt(overlay.style.width, 10),\r\n      height: parseInt(overlay.style.height, 10)\r\n    }]);\r\n\r\n    overlay.parentNode.removeChild(overlay);\r\n    overlay = null;\r\n\r\n    document.removeEventListener('mousemove', handleDocumentMousemove);\r\n    enableUserSelect();\r\n  }\r\n}\r\n\r\n/**\r\n * Handle document.keyup event\r\n *\r\n * @param {Event} e The DOM event to handle\r\n */\r\nfunction handleDocumentKeyup(e) {\r\n  // Cancel rect if Esc is pressed\r\n  if (e.keyCode === 27) {\r\n    let selection = window.getSelection();\r\n    selection.removeAllRanges();\r\n    if (overlay && overlay.parentNode) {\r\n      overlay.parentNode.removeChild(overlay);\r\n      overlay = null;\r\n      document.removeEventListener('mousemove', handleDocumentMousemove);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Save a rect annotation\r\n *\r\n * @param {String} type The type of rect (area, highlight, strikeout)\r\n * @param {Array} rects The rects to use for annotation\r\n * @param {String} color The color of the rects\r\n */\r\nfunction saveRect(type, rects, color) {\r\n  let svg = findSVGAtPoint(rects[0].left, rects[0].top);\r\n  let annotation;\r\n\r\n  if (!svg) {\r\n    return;\r\n  }\r\n\r\n  let boundingRect = svg.getBoundingClientRect();\r\n\r\n  if (!color) {\r\n    if (type === 'highlight') {\r\n      color = 'FFFF00';\r\n    }\r\n    else if (type === 'strikeout') {\r\n      color = 'FF0000';\r\n    }\r\n  }\r\n\r\n  // Initialize the annotation\r\n  annotation = {\r\n    type,\r\n    color,\r\n    rectangles: [...rects].map((r) => {\r\n      let offset = 0;\r\n\r\n      if (type === 'strikeout') {\r\n        offset = r.height / 2;\r\n      }\r\n\r\n      return convertToSvgRect({\r\n        y: (r.top + offset) - boundingRect.top,\r\n        x: r.left - boundingRect.left,\r\n        width: r.width,\r\n        height: r.height\r\n      }, svg);\r\n    }).filter((r) => r.width > 0 && r.height > 0 && r.x > -1 && r.y > -1)\r\n  };\r\n\r\n  // Short circuit if no rectangles exist\r\n  if (annotation.rectangles.length === 0) {\r\n    return;\r\n  }\r\n\r\n  // Special treatment for area as it only supports a single rect\r\n  if (type === 'area') {\r\n    let rect = annotation.rectangles[0];\r\n    delete annotation.rectangles;\r\n    annotation.x = rect.x;\r\n    annotation.y = rect.y;\r\n    annotation.width = rect.width;\r\n    annotation.height = rect.height;\r\n  }\r\n\r\n  let { documentId, pageNumber } = getMetadata(svg);\r\n\r\n  // Add the annotation\r\n  PDFJSAnnotate.getStoreAdapter().addAnnotation(documentId, pageNumber, annotation)\r\n    .then((annotation) => {\r\n      appendChild(svg, annotation);\r\n    });\r\n}\r\n\r\n/**\r\n * Enable rect behavior\r\n */\r\nexport function enableRect(type) {\r\n  _type = type;\r\n\r\n  if (_enabled) { return; }\r\n\r\n  _enabled = true;\r\n  document.addEventListener('mouseup', handleDocumentMouseup);\r\n  document.addEventListener('mousedown', handleDocumentMousedown);\r\n  document.addEventListener('keyup', handleDocumentKeyup);\r\n}\r\n\r\n/**\r\n * Disable rect behavior\r\n */\r\nexport function disableRect() {\r\n  if (!_enabled) { return; }\r\n\r\n  _enabled = false;\r\n  document.removeEventListener('mouseup', handleDocumentMouseup);\r\n  document.removeEventListener('mousedown', handleDocumentMousedown);\r\n  document.removeEventListener('keyup', handleDocumentKeyup);\r\n}\r\n\r\n","import PDFJSAnnotate from '../PDFJSAnnotate';\r\nimport { appendChild } from '../render/appendChild';\r\nimport {\r\n  findSVGAtPoint,\r\n  getMetadata,\r\n  convertToSvgPoint\r\n} from './utils';\r\n\r\nlet _enabled = false;\r\nlet _type;\r\nlet _circleRadius = 10;\r\nlet _circleColor = '0000FF';\r\n\r\n/**\r\n * Set the attributes of the pen.\r\n *\r\n * @param {Number} circleRadius The radius of the circle\r\n * @param {String} circleColor The color of the circle\r\n */\r\nexport function setCircle(circleRadius = 10, circleColor = '0000FF') {\r\n  _circleRadius = parseInt(circleRadius, 10);\r\n  _circleColor = circleColor;\r\n}\r\n\r\n/**\r\n * Handle document.mouseup event\r\n *\r\n * @param {Event} e The DOM event to handle\r\n */\r\nfunction handleDocumentMouseup(e) {\r\n  let svg = findSVGAtPoint(e.clientX, e.clientY);\r\n  if (!svg) {\r\n    return;\r\n  }\r\n  let rect = svg.getBoundingClientRect();\r\n  saveCircle(svg, _type, {\r\n    x: e.clientX - rect.left,\r\n    y: e.clientY - rect.top\r\n  }, _circleRadius, _circleColor);\r\n}\r\n\r\n/**\r\n * Save a circle annotation\r\n *\r\n * @param {SVGElement} svg\r\n * @param {String} type The type of circle (circle, emptycircle, fillcircle)\r\n * @param {Object} pt The point to use for annotation\r\n * @param {float} radius\r\n * @param {String} color The color of the rects\r\n */\r\nfunction saveCircle(svg, type, pt, radius, color) {\r\n  // Initialize the annotation\r\n  let svg_pt = convertToSvgPoint([ pt.x, pt.y ], svg);\r\n  let annotation = {\r\n    type,\r\n    color,\r\n    cx: svg_pt[0],\r\n    cy: svg_pt[1],\r\n    r: radius\r\n  };\r\n\r\n  let { documentId, pageNumber } = getMetadata(svg);\r\n\r\n  // Add the annotation\r\n  PDFJSAnnotate.getStoreAdapter().addAnnotation(documentId, pageNumber, annotation)\r\n    .then((annotation) => {\r\n      appendChild(svg, annotation);\r\n    });\r\n}\r\n\r\n/**\r\n * Enable circle behavior\r\n */\r\nexport function enableCircle(type) {\r\n  _type = type;\r\n\r\n  if (_enabled) { return; }\r\n\r\n  _enabled = true;\r\n  document.addEventListener('mouseup', handleDocumentMouseup);\r\n}\r\n\r\n/**\r\n * Disable circle behavior\r\n */\r\nexport function disableCircle() {\r\n  if (!_enabled) { return; }\r\n\r\n  _enabled = false;\r\n  document.removeEventListener('mouseup', handleDocumentMouseup);\r\n}\r\n\r\nexport function addCircle(type, e) {\r\n  let oldType = _type;\r\n  _type = type;\r\n  handleDocumentMouseup(e);\r\n  _type = oldType;\r\n}\r\n","import PDFJSAnnotate from '../PDFJSAnnotate';\r\nimport { appendChild } from '../render/appendChild';\r\nimport {\r\n  BORDER_COLOR,\r\n  findSVGAtPoint,\r\n  getMetadata,\r\n  convertToSvgPoint\r\n} from './utils';\r\n\r\nlet _enabled = false;\r\nlet input;\r\nlet _textSize = localStorage.getItem(`text/size`) || 12;\r\nlet _textColor = localStorage.getItem(`text/color`) || '#000000';\r\n\r\n/**\r\n * Handle document.mouseup event\r\n *\r\n * @param {Event} e The DOM event to handle\r\n */\r\nfunction handleDocumentMouseup(e) {\r\n  if (input || !findSVGAtPoint(e.clientX, e.clientY)) {\r\n    return;\r\n  }\r\n  if (!e.srcElement.classList.contains('annotationLayer')) {\r\n    return;\r\n  }\r\n  input = document.createElement('textarea');\r\n  input.setAttribute('id', 'pdf-annotate-text-input');\r\n  input.setAttribute('placeholder', 'Enter text... SHIFT + ENTER for new line');\r\n  input.style.border = `3px solid ${BORDER_COLOR}`;\r\n  input.style.borderRadius = '3px';\r\n  input.style.position = 'fixed';\r\n  input.style.top = `${e.clientY}px`;\r\n  input.style.left = `${e.clientX}px`;\r\n  input.style.fontSize = `${_textSize}px`;\r\n  input.style.zIndex = '41';\r\n  input.addEventListener('blur', handleInputBlur);\r\n  input.addEventListener('keyup', handleInputKeyup);\r\n\r\n  document.body.appendChild(input);\r\n  input.focus();\r\n}\r\n\r\n/**\r\n * Handle input.blur event\r\n */\r\nfunction handleInputBlur() {\r\n  saveText();\r\n}\r\n\r\n/**\r\n * Handle input.keyup event\r\n *\r\n * @param {Event} e The DOM event to handle\r\n */\r\nfunction handleInputKeyup(e) {\r\n  if (e.keyCode === 27) {\r\n    closeInput();\r\n  }\r\n  else if (e.keyCode === 13 && !e.shiftKey) {\r\n    saveText();\r\n  }\r\n}\r\n\r\n/**\r\n * Save a text annotation from input\r\n */\r\nfunction saveText() {\r\n  let value = (input.value) ? input.value.replace(/ +$/, '') : '';\r\n  if (value.length > 0) {\r\n    let clientX = parseInt(input.style.left, 10);\r\n    let clientY = parseInt(input.style.top, 10);\r\n    let svg = findSVGAtPoint(clientX, clientY);\r\n    if (!svg) {\r\n      return;\r\n    }\r\n    let height = _textSize;\r\n    let { documentId, pageNumber, viewport } = getMetadata(svg);\r\n    let scale = 1 / viewport.scale;\r\n    let rect = svg.getBoundingClientRect();\r\n    let pt = convertToSvgPoint([\r\n      clientX - rect.left,\r\n      clientY - rect.top + height], svg, viewport);\r\n    let annotation = {\r\n      type: 'textbox',\r\n      size: _textSize * scale,\r\n      color: _textColor,\r\n      content: value,\r\n      x: pt[0],\r\n      y: pt[1],\r\n      rotation: -viewport.rotation\r\n    };\r\n\r\n    PDFJSAnnotate.getStoreAdapter().addAnnotation(documentId, pageNumber, annotation)\r\n      .then((annotation) => {\r\n        appendChild(svg, annotation);\r\n      });\r\n  }\r\n\r\n  closeInput();\r\n}\r\n\r\n/**\r\n * Close the input\r\n */\r\nfunction closeInput() {\r\n  if (input) {\r\n    input.removeEventListener('blur', handleInputBlur);\r\n    input.removeEventListener('keyup', handleInputKeyup);\r\n    document.body.removeChild(input);\r\n    input = null;\r\n  }\r\n}\r\n\r\n/**\r\n * Set the text attributes\r\n *\r\n * @param {Number} textSize The size of the text\r\n * @param {String} textColor The color of the text\r\n */\r\nexport function setText(textSize = 12, textColor = '000000') {\r\n  _textSize = parseInt(textSize, 10);\r\n  _textColor = textColor;\r\n}\r\n\r\n/**\r\n * Enable text behavior\r\n */\r\nexport function enableText() {\r\n  if (_enabled) {\r\n    return;\r\n  }\r\n\r\n  _enabled = true;\r\n  document.addEventListener('mouseup', handleDocumentMouseup);\r\n}\r\n\r\n/**\r\n * Disable text behavior\r\n */\r\nexport function disableText() {\r\n  if (!_enabled) { return; }\r\n\r\n  _enabled = false;\r\n  document.removeEventListener('mouseup', handleDocumentMouseup);\r\n}\r\n\r\n","/**\r\n * Create a node that is only visible to screen readers\r\n *\r\n * @param {String} content The text content that should be read by screen reader\r\n * @param {String} [annotationId] The ID of the annotation assocaited\r\n * @return {Element} An Element that is only visible to screen readers\r\n */\r\nexport default function createScreenReaderOnly(content, annotationId) {\r\n  let node = document.createElement('div');\r\n  let text = document.createTextNode(content);\r\n  node.appendChild(text);\r\n  node.setAttribute('id', `pdf-annotate-screenreader-${annotationId}`);\r\n  node.style.position = 'absolute';\r\n  node.style.left = '-10000px';\r\n  node.style.top = 'auto';\r\n  node.style.width = '1px';\r\n  node.style.height = '1px';\r\n  node.style.overflow = 'hidden';\r\n  return node;\r\n}\r\n","import config from '../config';\r\nimport {\r\n  pointIntersectsRect,\r\n  scaleUp,\r\n  scaleDown\r\n} from '../UI/utils';\r\n\r\n/**\r\n * Insert an element at a point within the document.\r\n * This algorithm will only insert within an element amidst it's text content.\r\n *\r\n * @param {Element} el The element to be inserted\r\n * @param {Number} x The x coordinate of the point\r\n * @param {Number} y The y coordinate of the point\r\n * @param {Number} pageNumber The page number to limit elements to\r\n * @param {Boolean} insertBefore Whether the element is to be inserted before or after x\r\n * @return {Boolean} True if element was able to be inserted, otherwise false\r\n */\r\nexport default function insertElementWithinElement(el, x, y, pageNumber, insertBefore) {\r\n  const OFFSET_ADJUST = 2;\r\n\r\n  // If inserting before adjust `x` by looking for element a few px to the right\r\n  // Otherwise adjust a few px to the left\r\n  // This is to allow a little tolerance by searching within the box, instead\r\n  // of getting a false negative by testing right on the border.\r\n  x = Math.max(x + (OFFSET_ADJUST * (insertBefore ? 1 : -1)), 0);\r\n\r\n  let node = textLayerElementFromPoint(x, y + OFFSET_ADJUST, pageNumber);\r\n  if (!node) {\r\n    return false;\r\n  }\r\n\r\n  // Now that node has been found inverse the adjustment for `x`.\r\n  // This is done to accomodate tolerance by cutting off on the outside of the\r\n  // text boundary, instead of missing a character by cutting off within.\r\n  x = x + (OFFSET_ADJUST * (insertBefore ? -1 : 1));\r\n\r\n  let svg = document.querySelector(`svg[data-pdf-annotate-page=\"${pageNumber}\"]`);\r\n  let left = scaleDown(svg, {left: node.getBoundingClientRect().left}).left - svg.getBoundingClientRect().left;\r\n  let temp = node.cloneNode(true);\r\n  let head = temp.innerHTML.split('');\r\n  let tail = [];\r\n\r\n  // Insert temp off screen\r\n  temp.style.position = 'absolute';\r\n  temp.style.top = '-10000px';\r\n  temp.style.left = '-10000px';\r\n  document.body.appendChild(temp);\r\n\r\n  while (head.length) {\r\n    // Don't insert within HTML tags\r\n    if (head[head.length - 1] === '>') {\r\n      while (head.length) {\r\n        tail.unshift(head.pop());\r\n        if (tail[0] === '<') {\r\n          break;\r\n        }\r\n      }\r\n    }\r\n\r\n    // Check if width of temp based on current head value satisfies x\r\n    temp.innerHTML = head.join('');\r\n    let width = scaleDown(svg, {width: temp.getBoundingClientRect().width}).width;\r\n    if (left + width <= x) {\r\n      break;\r\n    }\r\n    tail.unshift(head.pop());\r\n  }\r\n\r\n  // Update original node with new markup, including element to be inserted\r\n  node.innerHTML = head.join('') + el.outerHTML + tail.join('');\r\n  temp.parentNode.removeChild(temp);\r\n\r\n  return true;\r\n}\r\n\r\n/**\r\n * Get a text layer element at a given point on a page\r\n *\r\n * @param {Number} x The x coordinate of the point\r\n * @param {Number} y The y coordinate of the point\r\n * @param {Number} pageNumber The page to limit elements to\r\n * @return {Element} First text layer element found at the point\r\n */\r\nfunction textLayerElementFromPoint(x, y, pageNumber) {\r\n  let svg = document.querySelector(`svg[data-pdf-annotate-page=\"${pageNumber}\"]`);\r\n  let rect = svg.getBoundingClientRect();\r\n  y = scaleUp(svg, {y}).y + rect.top;\r\n  x = scaleUp(svg, {x}).x + rect.left;\r\n  return [...svg.parentNode.querySelectorAll(config.textClassQuery() + ' [data-canvas-width]')].filter((el) => {\r\n    return pointIntersectsRect(x, y, el.getBoundingClientRect());\r\n  })[0];\r\n}\r\n","import config from '../config';\r\nimport insertElementWithinElement from './insertElementWithinElement';\r\nimport { pointIntersectsRect, scaleUp } from '../UI/utils';\r\n\r\n/**\r\n * Insert an element at a point within the document.\r\n * This algorithm will try to insert between elements if possible.\r\n * It will however use `insertElementWithinElement` if it is more accurate.\r\n *\r\n * @param {Element} el The element to be inserted\r\n * @param {Number} x The x coordinate of the point\r\n * @param {Number} y The y coordinate of the point\r\n * @param {Number} pageNumber The page number to limit elements to\r\n * @return {Boolean} True if element was able to be inserted, otherwise false\r\n */\r\nexport default function insertElementWithinChildren(el, x, y, pageNumber) {\r\n  // Try and use most accurate method of inserting within an element\r\n  if (insertElementWithinElement(el, x, y, pageNumber, true)) {\r\n    return true;\r\n  }\r\n\r\n  // Fall back to inserting between elements\r\n  let svg = document.querySelector(`svg[data-pdf-annotate-page=\"${pageNumber}\"]`);\r\n  let rect = svg.getBoundingClientRect();\r\n  let nodes = [...svg.parentNode.querySelectorAll(config.textClassQuery() + ' > div')];\r\n\r\n  y = scaleUp(svg, {y}).y + rect.top;\r\n  x = scaleUp(svg, {x}).x + rect.left;\r\n\r\n  // Find the best node to insert before\r\n  for (let i = 0, l = nodes.length; i < l; i++) {\r\n    let n = nodes[i];\r\n    let r = n.getBoundingClientRect();\r\n    if (y <= r.top) {\r\n      n.parentNode.insertBefore(el, n);\r\n      return true;\r\n    }\r\n  }\r\n\r\n  // If all else fails try to append to the bottom\r\n  let textLayer = svg.parentNode.querySelector(config.textClassQuery());\r\n  if (textLayer) {\r\n    let textRect = textLayer.getBoundingClientRect();\r\n    if (pointIntersectsRect(x, y, textRect)) {\r\n      textLayer.appendChild(el);\r\n      return true;\r\n    }\r\n  }\r\n\r\n  return false;\r\n}\r\n","/**\r\n * Insert a comment into the DOM to be available by screen reader\r\n *\r\n * @param {Object} comment The comment to be inserted\r\n */\r\nexport default function insertScreenReaderComment(comment) {\r\n  if (!comment) {\r\n    return;\r\n  }\r\n\r\n  let list = document.querySelector(`#pdf-annotate-screenreader-${comment.annotation} ol`);\r\n  if (list) {\r\n    let item = document.createElement('li');\r\n    item.setAttribute('id', `pdf-annotate-screenreader-comment-${comment.uuid}`);\r\n    item.appendChild(document.createTextNode(`${comment.content}`));\r\n    list.appendChild(item);\r\n  }\r\n}\r\n","import PDFJSAnnotate from '../PDFJSAnnotate';\r\nimport insertScreenReaderComment from './insertScreenReaderComment';\r\n\r\n/**\r\n * Insert the comments into the DOM to be available by screen reader\r\n *\r\n * Example output:\r\n *   <div class=\"screenReaderOnly\">\r\n *    <div>Begin highlight 1</div>\r\n *    <ol aria-label=\"Comments\">\r\n *      <li>Foo</li>\r\n *      <li>Bar</li>\r\n *      <li>Baz</li>\r\n *      <li>Qux</li>\r\n *    </ol>\r\n *  </div>\r\n *  <div>Some highlighted text goes here...</div>\r\n *  <div class=\"screenReaderOnly\">End highlight 1</div>\r\n *\r\n * NOTE: `screenReaderOnly` is not a real class, just used for brevity\r\n *\r\n * @param {String} documentId The ID of the document\r\n * @param {String} annotationId The ID of the annotation\r\n * @param {Array} [comments] Optionally preloaded comments to be rendered\r\n * @return {Promise} Promise that once has comments, render them for screen reader\r\n */\r\nexport default function renderScreenReaderComments(documentId, annotationId, comments) {\r\n  let promise;\r\n\r\n  if (Array.isArray(comments)) {\r\n    promise = Promise.resolve(comments);\r\n  }\r\n  else {\r\n    promise = PDFJSAnnotate.getStoreAdapter().getComments(documentId, annotationId);\r\n  }\r\n\r\n  return promise.then((comments) => {\r\n    // Node needs to be found by querying DOM as it may have been inserted as innerHTML\r\n    // leaving `screenReaderNode` as an invalid reference (see `insertElementWithinElement`).\r\n    let node = document.getElementById(`pdf-annotate-screenreader-${annotationId}`);\r\n    if (node) {\r\n      let list = document.createElement('ol');\r\n      list.setAttribute('id', `pdf-annotate-screenreader-comment-list-${annotationId}`);\r\n      list.setAttribute('aria-label', 'Comments');\r\n      node.appendChild(list);\r\n      comments.forEach(insertScreenReaderComment);\r\n    }\r\n  });\r\n}\r\n","import createScreenReaderOnly from './createScreenReaderOnly';\r\nimport insertElementWithinChildren from './insertElementWithinChildren';\r\nimport insertElementWithinElement from './insertElementWithinElement';\r\nimport renderScreenReaderComments from './renderScreenReaderComments';\r\n\r\n// Annotation types that support comments\r\nconst COMMENT_TYPES = ['highlight', 'point', 'area', 'circle', 'emptycircle', 'fillcircle'];\r\n\r\n/**\r\n * Insert a hint into the DOM for screen readers for a specific annotation.\r\n *\r\n * @param {Object} annotation The annotation to insert a hint for\r\n * @param {Number} num The number of the annotation out of all annotations of the same type\r\n */\r\nexport default function insertScreenReaderHint(annotation, num = 0) {\r\n  switch (annotation.type) {\r\n    case 'highlight':\r\n    case 'strikeout':\r\n      let rects = annotation.rectangles;\r\n      let first = rects[0];\r\n      let last = rects[rects.length - 1];\r\n\r\n      insertElementWithinElement(\r\n        createScreenReaderOnly(`Begin ${annotation.type} annotation ${num}`, annotation.uuid),\r\n        first.x, first.y, annotation.page, true\r\n      );\r\n\r\n      insertElementWithinElement(\r\n        createScreenReaderOnly(`End ${annotation.type} annotation ${num}`, `${annotation.uuid}-end`),\r\n        last.x + last.width, last.y, annotation.page, false\r\n      );\r\n      break;\r\n\r\n    case 'textbox':\r\n    case 'point':\r\n      let text = annotation.type === 'textbox' ? ` (content: ${annotation.content})` : '';\r\n\r\n      insertElementWithinChildren(\r\n        createScreenReaderOnly(`${annotation.type} annotation ${num}${text}`, annotation.uuid),\r\n        annotation.x, annotation.y, annotation.page\r\n      );\r\n      break;\r\n\r\n    case 'drawing':\r\n    case 'area':\r\n      let x = typeof annotation.x !== 'undefined' ? annotation.x : annotation.lines[0][0];\r\n      let y = typeof annotation.y !== 'undefined' ? annotation.y : annotation.lines[0][1];\r\n\r\n      insertElementWithinChildren(\r\n        createScreenReaderOnly(`Unlabeled drawing`, annotation.uuid),\r\n        x, y, annotation.page\r\n      );\r\n      break;\r\n\r\n    case 'circle':\r\n    case 'fillcircle':\r\n    case 'emptycircle':\r\n      let x2 = typeof annotation.cx !== 'undefined' ? annotation.cx : annotation.lines[0][0];\r\n      let y2 = typeof annotation.cy !== 'undefined' ? annotation.cy : annotation.lines[0][1];\r\n\r\n      insertElementWithinChildren(\r\n        createScreenReaderOnly(`Unlabeled drawing`, annotation.uuid),\r\n        x2, y2, annotation.page\r\n      );\r\n      break;\r\n  }\r\n\r\n  // Include comments in screen reader hint\r\n  if (COMMENT_TYPES.includes(annotation.type)) {\r\n    renderScreenReaderComments(annotation.documentId, annotation.uuid);\r\n  }\r\n}\r\n","import renderScreenReaderHints from './renderScreenReaderHints';\r\nimport insertScreenReaderComment from './insertScreenReaderComment';\r\nimport renderScreenReaderComments from './renderScreenReaderComments';\r\nimport { addEventListener } from '../UI/event';\r\nimport PDFJSAnnotate from '../PDFJSAnnotate';\r\n\r\n/**\r\n * Initialize the event handlers for keeping screen reader hints synced with data\r\n */\r\nexport default function initEventHandlers() {\r\n  addEventListener('annotation:add', (documentId, pageNumber, annotation) => {\r\n    reorderAnnotationsByType(documentId, pageNumber, annotation.type);\r\n  });\r\n  addEventListener('annotation:edit', (documentId, annotationId, annotation) => {\r\n    reorderAnnotationsByType(documentId, annotation.page, annotation.type);\r\n  });\r\n  addEventListener('annotation:delete', removeAnnotation);\r\n  addEventListener('comment:add', insertComment);\r\n  addEventListener('comment:delete', removeComment);\r\n}\r\n\r\n/**\r\n * Reorder the annotation numbers by annotation type\r\n *\r\n * @param {String} documentId The ID of the document\r\n * @param {Number} pageNumber The page number of the annotations\r\n * @param {Strig} type The annotation type\r\n */\r\nfunction reorderAnnotationsByType(documentId, pageNumber, type) {\r\n  PDFJSAnnotate.getStoreAdapter().getAnnotations(documentId, pageNumber)\r\n    .then((annotations) => {\r\n      return annotations.annotations.filter((a) => {\r\n        return a.type === type;\r\n      });\r\n    })\r\n    .then((annotations) => {\r\n      annotations.forEach((a) => {\r\n        removeAnnotation(documentId, a.uuid);\r\n      });\r\n\r\n      return annotations;\r\n    })\r\n    .then(renderScreenReaderHints);\r\n}\r\n\r\n/**\r\n * Remove the screen reader hint for an annotation\r\n *\r\n * @param {String} documentId The ID of the document\r\n * @param {String} annotationId The Id of the annotation\r\n */\r\nfunction removeAnnotation(documentId, annotationId) {\r\n  removeElementById(`pdf-annotate-screenreader-${annotationId}`);\r\n  removeElementById(`pdf-annotate-screenreader-${annotationId}-end`);\r\n}\r\n\r\n/**\r\n * Insert a screen reader hint for a comment\r\n *\r\n * @param {String} documentId The ID of the document\r\n * @param {String} annotationId The ID of tha assocated annotation\r\n * @param {Object} comment The comment to insert a hint for\r\n */\r\nfunction insertComment(documentId, annotationId, comment) {\r\n  let list = document.querySelector(`pdf-annotate-screenreader-comment-list-${annotationId}`);\r\n  let promise;\r\n\r\n  if (!list) {\r\n    promise = renderScreenReaderComments(documentId, annotationId, []).then(() => {\r\n      list = document.querySelector(`pdf-annotate-screenreader-comment-list-${annotationId}`);\r\n      return true;\r\n    });\r\n  }\r\n  else {\r\n    promise = Promise.resolve(true);\r\n  }\r\n\r\n  promise.then(() => {\r\n    insertScreenReaderComment(comment);\r\n  });\r\n}\r\n\r\n/**\r\n * Remove a screen reader hint for a comment\r\n *\r\n * @param {String} documentId The ID of the document\r\n * @param {String} commentId The ID of the comment\r\n */\r\nfunction removeComment(documentId, commentId) {\r\n  removeElementById(`pdf-annotate-screenreader-comment-${commentId}`);\r\n}\r\n\r\n/**\r\n * Remove an element from the DOM by it's ID if it exists\r\n *\r\n * @param {String} elementId The ID of the element to be removed\r\n */\r\nfunction removeElementById(elementId) {\r\n  let el = document.getElementById(elementId);\r\n  if (el) {\r\n    el.parentNode.removeChild(el);\r\n  }\r\n}\r\n","import insertScreenReaderHint from './insertScreenReaderHint';\r\nimport initEventHandlers from './initEventHandlers';\r\n\r\n// TODO This is not the right place for this to live\r\ninitEventHandlers();\r\n\r\n/**\r\n * Insert hints into the DOM for screen readers.\r\n *\r\n * @param {Array} annotations The annotations that hints are inserted for\r\n */\r\nexport default function renderScreenReaderHints(annotations) {\r\n  annotations = Array.isArray(annotations) ? annotations : [];\r\n\r\n  // Insert hints for each type\r\n  Object.keys(SORT_TYPES).forEach((type) => {\r\n    let sortBy = SORT_TYPES[type];\r\n    annotations\r\n      .filter((a) => a.type === type)\r\n      .sort(sortBy)\r\n      .forEach((a, i) => insertScreenReaderHint(a, i + 1));\r\n  });\r\n}\r\n\r\n// Sort annotations first by y, then by x.\r\n// This allows hints to be injected in the order they appear,\r\n// which makes numbering them easier.\r\nfunction sortByPoint(a, b) {\r\n  if (a.y < b.y) {\r\n    return a.x - b.x;\r\n  }\r\n  else {\r\n    return 1;\r\n  }\r\n}\r\n\r\n// Sort annotation by it's first rectangle\r\nfunction sortByRectPoint(a, b) {\r\n  return sortByPoint(a.rectangles[0], b.rectangles[0]);\r\n}\r\n\r\n// Sort annotation by it's first line\r\nfunction sortByLinePoint(a, b) {\r\n  let lineA = a.lines[0];\r\n  let lineB = b.lines[0];\r\n  return sortByPoint(\r\n    {x: lineA[0], y: lineA[1]},\r\n    {x: lineB[0], y: lineB[1]}\r\n  );\r\n}\r\n\r\n// Arrange supported types and associated sort methods\r\nconst SORT_TYPES = {\r\n  'highlight': sortByRectPoint,\r\n  'strikeout': sortByRectPoint,\r\n  'drawing': sortByLinePoint,\r\n  'textbox': sortByPoint,\r\n  'point': sortByPoint,\r\n  'area': sortByPoint\r\n};\r\n\r\n","import PDFJSAnnotate from '../PDFJSAnnotate';\r\nimport config from '../config';\r\nimport renderScreenReaderHints from '../a11y/renderScreenReaderHints';\r\n\r\n// Template for creating a new page\r\nconst PAGE_TEMPLATE = `\r\n  <div style=\"visibility: hidden;\" class=\"page\" data-loaded=\"false\">\r\n    <div class=\"canvasWrapper\">\r\n      <canvas></canvas>\r\n    </div>\r\n    <div class=\"` + config.textLayerName + `\"></div>\r\n    <svg class=\"` + config.annotationLayerName + `\"></svg>\r\n  </div>\r\n`;\r\n\r\n/**\r\n * Create a new page to be appended to the DOM.\r\n *\r\n * @param {Number} pageNumber The page number that is being created\r\n * @return {HTMLElement}\r\n */\r\nexport function createPage(pageNumber) {\r\n  let temp = document.createElement('div');\r\n  temp.innerHTML = PAGE_TEMPLATE;\r\n\r\n  let page = temp.children[0];\r\n  let canvas = page.querySelector('canvas');\r\n\r\n  page.setAttribute('id', `pageContainer${pageNumber}`);\r\n  page.setAttribute('data-page-number', pageNumber);\r\n\r\n  canvas.mozOpaque = true;\r\n  canvas.setAttribute('id', `page${pageNumber}`);\r\n\r\n  return page;\r\n}\r\n\r\n/**\r\n * Render a page that has already been created.\r\n *\r\n * @param {Number} pageNumber The page number to be rendered\r\n * @param {Object} renderOptions The options for rendering\r\n * @return {Promise} Settled once rendering has completed\r\n *  A settled Promise will be either:\r\n *    - fulfilled: [pdfPage, annotations]\r\n *    - rejected: Error\r\n */\r\nexport function renderPage(pageNumber, renderOptions) {\r\n  let {\r\n    documentId,\r\n    pdfDocument,\r\n    scale,\r\n    rotate\r\n  } = renderOptions;\r\n\r\n  const eventBus = new pdfjsViewer.EventBus();\r\n\r\n  // Load the page and annotations\r\n  return Promise.all([\r\n    pdfDocument.getPage(pageNumber),\r\n    PDFJSAnnotate.getAnnotations(documentId, pageNumber)\r\n  ]).then(([pdfPage, annotations]) => {\r\n    let page = document.getElementById(`pageContainer${pageNumber}`);\r\n    let svg = page.querySelector(config.annotationClassQuery());\r\n    let canvas = page.querySelector('.canvasWrapper canvas');\r\n    let canvasContext = canvas.getContext('2d', {alpha: false});\r\n    let totalRotation = (rotate + pdfPage.rotate) % 360;\r\n    let viewport = pdfPage.getViewport({scale: scale, rotation: totalRotation});\r\n    let transform = scalePage(pageNumber, viewport, canvasContext);\r\n\r\n    // Render the page\r\n    return Promise.all([\r\n      pdfPage.render({ canvasContext, viewport, transform }).promise,\r\n      PDFJSAnnotate.render(svg, viewport, annotations)\r\n    ]).then(() => {\r\n      // Text content is needed for a11y, but is also necessary for creating\r\n      // highlight and strikeout annotations which require selecting text.\r\n      return pdfPage.getTextContent({normalizeWhitespace: true}).then((textContent) => {\r\n        return new Promise((resolve, reject) => {\r\n          // Render text layer for a11y of text content\r\n          let textLayer = page.querySelector(config.textClassQuery());\r\n          let textLayerFactory = new pdfjsViewer.DefaultTextLayerFactory();\r\n          let textLayerBuilder = textLayerFactory.createTextLayerBuilder(\r\n            textLayer,\r\n            pageNumber - 1,\r\n            viewport,\r\n            false,\r\n            eventBus\r\n          );\r\n          textLayerBuilder.setTextContent(textContent);\r\n          textLayerBuilder.render();\r\n\r\n          // Enable a11y for annotations\r\n          // Timeout is needed to wait for `textLayerBuilder.render`\r\n          setTimeout(() => {\r\n            try {\r\n              renderScreenReaderHints(annotations.annotations);\r\n              resolve();\r\n            }\r\n            catch (e) {\r\n              reject(e);\r\n            }\r\n          });\r\n        });\r\n      });\r\n    }).then(() => {\r\n      // Indicate that the page was loaded\r\n      page.setAttribute('data-loaded', 'true');\r\n\r\n      return [pdfPage, annotations];\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Scale the elements of a page.\r\n *\r\n * @param {Number} pageNumber The page number to be scaled\r\n * @param {Object} viewport The viewport of the PDF page (see pdfPage.getViewport(scale, rotate))\r\n * @param {Object} context The canvas context that the PDF page is rendered to\r\n * @return {Array} The transform data for rendering the PDF page\r\n */\r\nfunction scalePage(pageNumber, viewport, context) {\r\n  let page = document.getElementById(`pageContainer${pageNumber}`);\r\n  let canvas = page.querySelector('.canvasWrapper canvas');\r\n  let svg = page.querySelector(config.annotationClassQuery());\r\n  let wrapper = page.querySelector('.canvasWrapper');\r\n  let textLayer = page.querySelector(config.textClassQuery());\r\n  let outputScale = getOutputScale(context);\r\n  let transform = !outputScale.scaled ? null : [outputScale.sx, 0, 0, outputScale.sy, 0, 0];\r\n  let sfx = approximateFraction(outputScale.sx);\r\n  let sfy = approximateFraction(outputScale.sy);\r\n\r\n  // Adjust width/height for scale\r\n  page.style.visibility = '';\r\n  canvas.width = roundToDivide(viewport.width * outputScale.sx, sfx[0]);\r\n  canvas.height = roundToDivide(viewport.height * outputScale.sy, sfy[0]);\r\n  canvas.style.width = roundToDivide(viewport.width, sfx[1]) + 'px';\r\n  canvas.style.height = roundToDivide(viewport.height, sfx[1]) + 'px';\r\n  svg.setAttribute('width', viewport.width);\r\n  svg.setAttribute('height', viewport.height);\r\n  svg.style.width = `${viewport.width}px`;\r\n  svg.style.height = `${viewport.height}px`;\r\n  page.style.width = `${viewport.width}px`;\r\n  page.style.height = `${viewport.height}px`;\r\n  wrapper.style.width = `${viewport.width}px`;\r\n  wrapper.style.height = `${viewport.height}px`;\r\n  textLayer.style.width = `${viewport.width}px`;\r\n  textLayer.style.height = `${viewport.height}px`;\r\n\r\n  return transform;\r\n}\r\n\r\n/**\r\n * Approximates a float number as a fraction using Farey sequence (max order of 8).\r\n *\r\n * @param {Number} x Positive float number\r\n * @return {Array} Estimated fraction: the first array item is a numerator,\r\n *                 the second one is a denominator.\r\n */\r\nfunction approximateFraction(x) {\r\n  // Fast path for int numbers or their inversions.\r\n  if (Math.floor(x) === x) {\r\n    return [x, 1];\r\n  }\r\n\r\n  const xinv = 1 / x;\r\n  const limit = 8;\r\n  if (xinv > limit) {\r\n    return [1, limit];\r\n  }\r\n  else if (Math.floor(xinv) === xinv) {\r\n    return [1, xinv];\r\n  }\r\n\r\n  const x_ = x > 1 ? xinv : x;\r\n\r\n  // a/b and c/d are neighbours in Farey sequence.\r\n  let a = 0; let b = 1; let c = 1; let d = 1;\r\n\r\n  // Limit search to order 8.\r\n  while (true) {\r\n    // Generating next term in sequence (order of q).\r\n    let p = a + c; let q = b + d;\r\n    if (q > limit) {\r\n      break;\r\n    }\r\n    if (x_ <= p / q) {\r\n      c = p; d = q;\r\n    }\r\n    else {\r\n      a = p; b = q;\r\n    }\r\n  }\r\n\r\n  // Select closest of neighbours to x.\r\n  if (x_ - a / b < c / d - x_) {\r\n    return x_ === x ? [a, b] : [b, a];\r\n  }\r\n  else {\r\n    return x_ === x ? [c, d] : [d, c];\r\n  }\r\n}\r\n\r\nfunction getOutputScale(ctx) {\r\n  let devicePixelRatio = window.devicePixelRatio || 1;\r\n  let backingStoreRatio = ctx.webkitBackingStorePixelRatio ||\r\n                          ctx.mozBackingStorePixelRatio ||\r\n                          ctx.msBackingStorePixelRatio ||\r\n                          ctx.oBackingStorePixelRatio ||\r\n                          ctx.backingStorePixelRatio || 1;\r\n  let pixelRatio = devicePixelRatio / backingStoreRatio;\r\n  return {\r\n    sx: pixelRatio,\r\n    sy: pixelRatio,\r\n    scaled: pixelRatio !== 1\r\n  };\r\n}\r\n\r\nfunction roundToDivide(x, div) {\r\n  let r = x % div;\r\n  return r === 0 ? x : Math.round(x - r + div);\r\n}\r\n","import { addEventListener, removeEventListener, fireEvent } from './event';\r\nimport { disableEdit, enableEdit } from './edit';\r\nimport { disablePen, enablePen, setPen } from './pen';\r\nimport { disableArrow, enableArrow, setArrow } from './arrow';\r\nimport { disableEraser, enableEraser } from './eraser';\r\nimport { disablePoint, enablePoint } from './point';\r\nimport { disableRect, enableRect } from './rect';\r\nimport { disableCircle, enableCircle, setCircle, addCircle } from './circle';\r\nimport { disableText, enableText, setText } from './text';\r\nimport { createPage, renderPage } from './page';\r\n\r\nexport default {\r\n  addEventListener,\r\n  removeEventListener,\r\n  fireEvent,\r\n\r\n  disableEdit,\r\n  enableEdit,\r\n\r\n  disablePen,\r\n  enablePen,\r\n  setPen,\r\n\r\n  disablePoint,\r\n  enablePoint,\r\n\r\n  disableRect,\r\n  enableRect,\r\n\r\n  disableCircle,\r\n  enableCircle,\r\n  setCircle,\r\n  addCircle,\r\n\r\n  disableArrow,\r\n  enableArrow,\r\n  setArrow,\r\n\r\n  disableEraser,\r\n  enableEraser,\r\n\r\n  disableText,\r\n  enableText,\r\n  setText,\r\n\r\n  createPage,\r\n  renderPage\r\n};\r\n","import StoreAdapter from './adapter/StoreAdapter';\r\nimport LocalStoreAdapter from './adapter/LocalStoreAdapter';\r\nimport LocalUserStoreAdapter from './adapter/LocalUserStoreAdapter';\r\nimport render from './render';\r\nimport UI from './UI';\r\nimport config from './config';\r\nimport uuid from './utils/uuid';\r\nimport {\r\n  findAnnotationAtPoint,\r\n  findSVGContainer,\r\n  convertToScreenPoint\r\n} from './UI/utils';\r\n\r\nexport default {\r\n  findAnnotationAtPoint,\r\n  findSVGContainer,\r\n  convertToScreenPoint,\r\n\r\n  /**\r\n   * Abstract class that needs to be defined so PDFJSAnnotate\r\n   * knows how to communicate with your server.\r\n   */\r\n  StoreAdapter,\r\n\r\n  /**\r\n   * Implementation of StoreAdapter that stores annotation data to localStorage.\r\n   */\r\n  LocalStoreAdapter,\r\n\r\n  /**\r\n   * Implementation of StoreAdapter that stores annotation data to localStorage particular\r\n   * to a specific user\r\n   */\r\n  LocalUserStoreAdapter,\r\n\r\n  /**\r\n   * Abstract instance of StoreAdapter\r\n   */\r\n  __storeAdapter: new StoreAdapter(),\r\n\r\n  /**\r\n   * Getter for the underlying StoreAdapter property\r\n   *\r\n   * @return {StoreAdapter}\r\n   */\r\n  getStoreAdapter() {\r\n    return this.__storeAdapter;\r\n  },\r\n\r\n  /**\r\n   * Setter for the underlying StoreAdapter property\r\n   *\r\n   * @param {StoreAdapter} adapter The StoreAdapter implementation to be used.\r\n   */\r\n  setStoreAdapter(adapter) {\r\n    // TODO this throws an error when bundled\r\n    // if (!(adapter instanceof StoreAdapter)) {\r\n    //   throw new Error('adapter must be an instance of StoreAdapter');\r\n    // }\r\n\r\n    this.__storeAdapter = adapter;\r\n  },\r\n\r\n  /**\r\n   * UI is a helper for instrumenting UI interactions for creating,\r\n   * editing, and deleting annotations in the browser.\r\n   */\r\n  UI,\r\n\r\n  /**\r\n   * Render the annotations for a page in the PDF Document\r\n   *\r\n   * @param {SVGElement} svg The SVG element that annotations should be rendered to\r\n   * @param {PageViewport} viewport The PDFPage.getViewport data\r\n   * @param {Object} data The StoreAdapter.getAnnotations data\r\n   * @return {Promise}\r\n   */\r\n  render,\r\n\r\n  /**\r\n   * Convenience method for getting annotation data\r\n   *\r\n   * @alias StoreAdapter.getAnnotations\r\n   * @param {String} documentId The ID of the document\r\n   * @param {String} pageNumber The page number\r\n   * @return {Promise}\r\n   */\r\n  getAnnotations(documentId, pageNumber) {\r\n    return this.getStoreAdapter().getAnnotations(...arguments);\r\n  },\r\n\r\n  config,\r\n\r\n  uuid\r\n};\r\n","import { appendChild, transformChild } from './appendChild';\r\n\r\n/**\r\n * Render the response from PDFJSAnnotate.getStoreAdapter().getAnnotations to SVG\r\n *\r\n * @param {SVGElement} svg The SVG element to render the annotations to\r\n * @param {Object} viewport The page viewport data\r\n * @param {Object} data The response from PDFJSAnnotate.getStoreAdapter().getAnnotations\r\n * @return {Promise} Settled once rendering has completed\r\n *  A settled Promise will be either:\r\n *    - fulfilled: SVGElement\r\n *    - rejected: Error\r\n */\r\nexport default function render(svg, viewport, data) {\r\n  return new Promise((resolve, reject) => {\r\n    // Reset the content of the SVG\r\n    svg.setAttribute('data-pdf-annotate-container', true);\r\n    svg.setAttribute('data-pdf-annotate-viewport', JSON.stringify(viewport));\r\n    svg.removeAttribute('data-pdf-annotate-document');\r\n    svg.removeAttribute('data-pdf-annotate-page');\r\n\r\n    // If there's no data nothing can be done\r\n    if (!data) {\r\n      svg.innerHTML = '';\r\n      return resolve(svg);\r\n    }\r\n\r\n    svg.setAttribute('data-pdf-annotate-document', data.documentId);\r\n    svg.setAttribute('data-pdf-annotate-page', data.pageNumber);\r\n\r\n    // Make sure annotations is an array\r\n    if (!Array.isArray(data.annotations) || data.annotations.length === 0) {\r\n      return resolve(svg);\r\n    }\r\n\r\n    // Append or transform annotation to svg\r\n    data.annotations.forEach((a) => {\r\n      let node = svg.querySelector('[data-pdf-annotate-id=\"' + a.uuid + '\"]');\r\n      if (node) {\r\n        transformChild(svg, node, viewport);\r\n      }\r\n      else {\r\n        appendChild(svg, a, viewport);\r\n      }\r\n    });\r\n\r\n    resolve(svg);\r\n  });\r\n}\r\n","import PDFJSAnnotate from './src/PDFJSAnnotate';\r\n\r\nexport default PDFJSAnnotate;\r\n"],"sourceRoot":""}